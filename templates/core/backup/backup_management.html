{% extends "base.html" %}
{% load static %}
{% load utils_extras %}

{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/shared-components.css' %}">
<link rel="stylesheet" href="{% static 'css/unified-components.css' %}">
<style>
.backup-tab-content { display: none; }
.backup-tab-content.active { display: block; }
.backup-type-card { cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
.backup-type-card:hover { border-color: var(--primary-color); transform: translateY(-2px); }
.backup-type-card.selected { border-color: var(--primary-color); background-color: var(--light-bg); }
.backup-progress { display: none; }
.backup-progress.active { display: block; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% csrf_token %}
    
    {% include "shared/page_header.html" with title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©" subtitle="Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…" icon="fas fa-database" breadcrumb_items=breadcrumb_items %}
    
    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-tab="create" href="#"><i class="fas fa-plus-circle me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-tab="list" href="#"><i class="fas fa-list me-2"></i>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-tab="restore-upload" href="#"><i class="fas fa-upload me-2"></i>Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù…Ù„Ù</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-tab="settings" href="#"><i class="fas fa-cog me-2"></i>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
        </li>
    </ul>
    
    <!-- Tab 1: Create Backup -->
    <div class="backup-tab-content active" id="tab-create">
        <div class="section-container">
            <h5 class="section-title"><i class="fas fa-database me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h5>
            
            <form id="createBackupForm">
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <div class="backup-type-card card p-3 text-center" data-type="full">
                            <i class="fas fa-server fa-3x mb-3 text-primary"></i>
                            <h6>Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø©</h6>
                            <small class="text-muted">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª + Ø§Ù„Ù…Ù„ÙØ§Øª</small>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="backup-type-card card p-3 text-center" data-type="database">
                            <i class="fas fa-database fa-3x mb-3 text-info"></i>
                            <h6>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·</h6>
                            <small class="text-muted">Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª</small>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="backup-type-card card p-3 text-center" data-type="media">
                            <i class="fas fa-images fa-3x mb-3 text-success"></i>
                            <h6>Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙ‚Ø·</h6>
                            <small class="text-muted">Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</small>
                        </div>
                    </div>
                </div>
                
                <input type="hidden" id="backupType" name="backup_type" value="full">
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6 class="mb-3">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­ÙØ¸:</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="save_mode" id="saveServer" value="server" checked>
                            <label class="form-check-label" for="saveServer">
                                <i class="fas fa-server me-2"></i>Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="save_mode" id="saveDownload" value="download">
                            <label class="form-check-label" for="saveDownload">
                                <i class="fas fa-download me-2"></i>ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h6 class="mb-3">Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="compressBackup" checked disabled>
                            <label class="form-check-label" for="compressBackup">
                                <i class="fas fa-compress me-2"></i>Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù (Ù…ÙØ¹Ù‘Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="backup-progress mb-3">
                    <div class="alert alert-info">
                        <i class="fas fa-spinner fa-spin me-2"></i>
                        <span id="progressText">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg" id="createBackupBtn">
                    <i class="fas fa-rocket me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </button>
            </form>
        </div>
    </div>
    
    <!-- Tab 2: List Backups -->
    <div class="backup-tab-content" id="tab-list">
        <div class="section-container">
            <h5 class="section-title">
                <i class="fas fa-list me-2"></i>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                <button class="btn btn-sm btn-outline-primary float-end" onclick="refreshBackupList()">
                    <i class="fas fa-sync-alt me-1"></i>ØªØ­Ø¯ÙŠØ«
                </button>
            </h5>
            
            <div id="backupListContainer">
                <div class="text-center py-5">
                    <i class="fas fa-spinner fa-spin fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tab 3: Restore from Upload -->
    <div class="backup-tab-content" id="tab-restore-upload">
        <div class="section-container">
            <h5 class="section-title"><i class="fas fa-upload me-2"></i>Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù…Ù„Ù Ø®Ø§Ø±Ø¬ÙŠ</h5>
            
            <div class="alert alert-danger mb-4">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>ØªØ­Ø°ÙŠØ±:</strong> Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø³ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.
            </div>
            
            <form id="restoreUploadForm" enctype="multipart/form-data">
                <div class="row">
                    <div class="col-md-8 offset-md-2">
                        <div class="card border-warning mb-4">
                            <div class="card-header bg-warning text-dark">
                                <i class="fas fa-file-upload me-2"></i>Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="backupFile" class="form-label">Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</label>
                                    <input type="file" class="form-control" id="backupFile" name="backup_file" required accept=".sql,.gz,.tar,.tar.gz,.zip,.db,.sqlite3">
                                    <small class="form-text text-muted">
                                        Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: .sql, .sql.gz, .tar.gz, .zip, .db, .sqlite3
                                    </small>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="restore_type" id="restoreAuto" value="auto" checked>
                                        <label class="form-check-label" for="restoreAuto">
                                            <i class="fas fa-magic me-2"></i>ØªØ­Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù…ÙˆØµÙ‰ Ø¨Ù‡)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="restore_type" id="restoreDatabase" value="database">
                                        <label class="form-check-label" for="restoreDatabase">
                                            <i class="fas fa-database me-2"></i>Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="restore_type" id="restoreMedia" value="media">
                                        <label class="form-check-label" for="restoreMedia">
                                            <i class="fas fa-images me-2"></i>Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ ÙÙ‚Ø·
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="restore_type" id="restoreFull" value="full">
                                        <label class="form-check-label" for="restoreFull">
                                            <i class="fas fa-server me-2"></i>Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø© (Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª + Ù…ÙŠØ¯ÙŠØ§)
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input type="checkbox" class="form-check-input" id="confirmRestore" required>
                                    <label class="form-check-label" for="confirmRestore">
                                        <strong>Ø£Ø¤ÙƒØ¯ Ø£Ù†Ù†ÙŠ Ø£ÙÙ‡Ù… Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø³ØªØ³ØªØ¨Ø¯Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</strong>
                                    </label>
                                </div>
                                
                                <div class="restore-upload-progress mb-3" style="display: none;">
                                    <div class="alert alert-info">
                                        <i class="fas fa-spinner fa-spin me-2"></i>
                                        <span id="restoreProgressText">Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-danger btn-lg w-100" id="restoreUploadBtn">
                                    <i class="fas fa-upload me-2"></i>Ø±ÙØ¹ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Tab 4: Settings -->
    <div class="backup-tab-content" id="tab-settings">
        <div class="section-container">
            <h5 class="section-title"><i class="fas fa-cog me-2"></i>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h5>
            
            <form id="backupSettingsForm">
                <!-- Database Backups Settings -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="fas fa-database me-2"></i>Ù†Ø³Ø® Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="mb-3">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸:</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="db_retention_type" id="dbRetentionCount" value="count" checked>
                                    <label class="form-check-label" for="dbRetentionCount">
                                        Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 
                                        <input type="number" class="form-control d-inline-block mx-2" style="width: 80px;" id="dbRetentionCountValue" value="10" min="1" max="100">
                                        Ù†Ø³Ø®Ø©
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="db_retention_type" id="dbRetentionDays" value="days">
                                    <label class="form-check-label" for="dbRetentionDays">
                                        Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù†Ø³Ø® Ù„Ù…Ø¯Ø© 
                                        <input type="number" class="form-control d-inline-block mx-2" style="width: 80px;" id="dbRetentionDaysValue" value="30" min="1" max="365">
                                        ÙŠÙˆÙ…
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="db_retention_type" id="dbRetentionNone" value="none">
                                    <label class="form-check-label" for="dbRetentionNone">
                                        Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="dbAutoCleanup" checked>
                                    <label class="form-check-label" for="dbAutoCleanup">
                                        ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                                    </label>
                                </div>
                                <div class="alert alert-sm alert-info">
                                    <small><i class="fas fa-info-circle me-1"></i>ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ù†Ø³Ø® Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Full Backups Settings -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-server me-2"></i>Ø§Ù„Ù†Ø³Ø® Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="mb-3">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸:</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="full_retention_type" id="fullRetentionCount" value="count" checked>
                                    <label class="form-check-label" for="fullRetentionCount">
                                        Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 
                                        <input type="number" class="form-control d-inline-block mx-2" style="width: 80px;" id="fullRetentionCountValue" value="5" min="1" max="100">
                                        Ù†Ø³Ø®Ø©
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="full_retention_type" id="fullRetentionDays" value="days">
                                    <label class="form-check-label" for="fullRetentionDays">
                                        Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù†Ø³Ø® Ù„Ù…Ø¯Ø© 
                                        <input type="number" class="form-control d-inline-block mx-2" style="width: 80px;" id="fullRetentionDaysValue" value="60" min="1" max="365">
                                        ÙŠÙˆÙ…
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="full_retention_type" id="fullRetentionNone" value="none">
                                    <label class="form-check-label" for="fullRetentionNone">
                                        Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="fullAutoCleanup" checked>
                                    <label class="form-check-label" for="fullAutoCleanup">
                                        ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                                    </label>
                                </div>
                                <div class="alert alert-sm alert-info">
                                    <small><i class="fas fa-info-circle me-1"></i>ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙÙ‚Ø·</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Backups Settings -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="fas fa-images me-2"></i>Ù†Ø³Ø® Ø§Ù„Ù…Ù„ÙØ§Øª (Media)
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="mb-3">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸:</h6>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="media_retention_type" id="mediaRetentionCount" value="count" checked>
                                    <label class="form-check-label" for="mediaRetentionCount">
                                        Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 
                                        <input type="number" class="form-control d-inline-block mx-2" style="width: 80px;" id="mediaRetentionCountValue" value="3" min="1" max="100">
                                        Ù†Ø³Ø®Ø©
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="media_retention_type" id="mediaRetentionDays" value="days">
                                    <label class="form-check-label" for="mediaRetentionDays">
                                        Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù†Ø³Ø® Ù„Ù…Ø¯Ø© 
                                        <input type="number" class="form-control d-inline-block mx-2" style="width: 80px;" id="mediaRetentionDaysValue" value="90" min="1" max="365">
                                        ÙŠÙˆÙ…
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="media_retention_type" id="mediaRetentionNone" value="none">
                                    <label class="form-check-label" for="mediaRetentionNone">
                                        Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="mediaAutoCleanup" checked>
                                    <label class="form-check-label" for="mediaAutoCleanup">
                                        ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                                    </label>
                                </div>
                                <div class="alert alert-sm alert-info">
                                    <small><i class="fas fa-info-circle me-1"></i>ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ù†Ø³Ø® Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙ‚Ø·</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Automatic Backup Schedule -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <i class="fas fa-clock me-2"></i>Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯ Cron Job Ø£Ùˆ Windows Task Scheduler Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±.
                        </div>

                        <div class="row">
                            <!-- Daily Database Backup -->
                            <div class="col-md-4 mb-3">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <i class="fas fa-database me-2"></i>Ù†Ø³Ø® ÙŠÙˆÙ…ÙŠ - Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="enableDailyDbBackup">
                                            <label class="form-check-label" for="enableDailyDbBackup">
                                                <strong>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ÙŠÙˆÙ…ÙŠ</strong>
                                            </label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ø§Ù„ÙˆÙ‚Øª:</label>
                                            <input type="time" class="form-control" id="dailyDbBackupTime" value="02:00">
                                        </div>
                                        <small class="text-muted">
                                            <i class="fas fa-lightbulb me-1"></i>ÙŠÙÙ†ØµØ­ Ø¨ÙˆÙ‚Øª Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (2-4 ØµØ¨Ø§Ø­Ø§Ù‹)
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <!-- Weekly Full Backup -->
                            <div class="col-md-4 mb-3">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <i class="fas fa-server me-2"></i>Ù†Ø³Ø® Ø£Ø³Ø¨ÙˆØ¹ÙŠ - ÙƒØ§Ù…Ù„
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="enableWeeklyFullBackup">
                                            <label class="form-check-label" for="enableWeeklyFullBackup">
                                                <strong>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</strong>
                                            </label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ø§Ù„ÙŠÙˆÙ…:</label>
                                            <select class="form-select" id="weeklyFullBackupDay">
                                                <option value="0">Ø§Ù„Ø£Ø­Ø¯</option>
                                                <option value="1">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                                                <option value="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                                                <option value="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                                                <option value="4">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                                                <option value="5" selected>Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
                                                <option value="6">Ø§Ù„Ø³Ø¨Øª</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ø§Ù„ÙˆÙ‚Øª:</label>
                                            <input type="time" class="form-control" id="weeklyFullBackupTime" value="03:00">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Monthly Media Backup -->
                            <div class="col-md-4 mb-3">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <i class="fas fa-images me-2"></i>Ù†Ø³Ø® Ø´Ù‡Ø±ÙŠ - Ù…Ù„ÙØ§Øª
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="enableMonthlyMediaBackup">
                                            <label class="form-check-label" for="enableMonthlyMediaBackup">
                                                <strong>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø´Ù‡Ø±ÙŠ</strong>
                                            </label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø´Ù‡Ø±:</label>
                                            <input type="number" class="form-control" id="monthlyMediaBackupDay" value="1" min="1" max="28">
                                            <small class="text-muted">Ù…Ù† 1 Ø¥Ù„Ù‰ 28</small>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ø§Ù„ÙˆÙ‚Øª:</label>
                                            <input type="time" class="form-control" id="monthlyMediaBackupTime" value="04:00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cron Commands -->
                        <div class="alert alert-secondary mt-3">
                            <h6><i class="fas fa-terminal me-2"></i>Ø£ÙˆØ§Ù…Ø± Cron Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±:</h6>
                            <div class="mb-2">
                                <strong>Ù†Ø³Ø® ÙŠÙˆÙ…ÙŠ (Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª):</strong>
                                <code class="d-block bg-dark text-light p-2 rounded mt-1">
                                    0 2 * * * cd /path/to/project && python manage.py create_backup --type=database
                                </code>
                            </div>
                            <div class="mb-2">
                                <strong>Ù†Ø³Ø® Ø£Ø³Ø¨ÙˆØ¹ÙŠ (ÙƒØ§Ù…Ù„):</strong>
                                <code class="d-block bg-dark text-light p-2 rounded mt-1">
                                    0 3 * * 5 cd /path/to/project && python manage.py create_backup --type=full
                                </code>
                            </div>
                            <div>
                                <strong>Ù†Ø³Ø® Ø´Ù‡Ø±ÙŠ (Ù…Ù„ÙØ§Øª):</strong>
                                <code class="d-block bg-dark text-light p-2 rounded mt-1">
                                    0 4 1 * * cd /path/to/project && python manage.py create_backup --type=media
                                </code>
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <i class="fas fa-info-circle me-1"></i>
                                Ø§Ø³ØªØ¨Ø¯Ù„ <code>/path/to/project</code> Ø¨Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ
                            </small>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success btn-lg">
                    <i class="fas fa-save me-2"></i>Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Restore Modal -->
<div class="modal fade" id="restoreModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-undo me-2"></i>Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>ØªØ­Ø°ÙŠØ±:</strong> Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.
                </div>
                <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: <strong id="restoreBackupId"></strong>ØŸ</p>
                <input type="hidden" id="restoreBackupIdInput">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-danger" onclick="confirmRestore()">
                    <i class="fas fa-undo me-2"></i>Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Tab switching
    $('.nav-link[data-tab]').click(function(e) {
        e.preventDefault();
        const tab = $(this).data('tab');
        
        $('.nav-link').removeClass('active');
        $(this).addClass('active');
        
        $('.backup-tab-content').removeClass('active');
        $(`#tab-${tab}`).addClass('active');
        
        if (tab === 'list') {
            loadBackupList();
        }
    });
    
    // Backup type selection
    $('.backup-type-card').click(function() {
        $('.backup-type-card').removeClass('selected');
        $(this).addClass('selected');
        $('#backupType').val($(this).data('type'));
    });
    
    // Select first card by default
    $('.backup-type-card[data-type="full"]').addClass('selected');
    
    // Create backup form
    $('#createBackupForm').submit(function(e) {
        e.preventDefault();
        createBackup();
    });
    
    // Settings form
    $('#backupSettingsForm').submit(function(e) {
        e.preventDefault();
        saveSettings();
    });
    
    // Restore upload form
    $('#restoreUploadForm').submit(function(e) {
        e.preventDefault();
        restoreFromUpload();
    });
    
    // Load settings on page load
    loadSettings();
});

function createBackup() {
    const backupType = $('#backupType').val();
    const saveMode = $('input[name="save_mode"]:checked').val();
    const downloadMode = saveMode === 'download';
    
    $('#createBackupBtn').prop('disabled', true);
    $('.backup-progress').addClass('active');
    $('#progressText').text('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
    
    const ajaxSettings = {
        url: '{% url "core:backup_create" %}',
        method: 'POST',
        data: {
            backup_type: backupType,
            download_mode: downloadMode ? 'true' : 'false',
            csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()
        },
        success: function(response, status, xhr) {
            $('.backup-progress').removeClass('active');
            $('#createBackupBtn').prop('disabled', false);
            
            // Debug: log response
            console.log('Backup response:', response);
            if (response.warnings && response.warnings.length > 0) {
                console.warn('Backup warnings:', response.warnings);
            }
            if (response.errors && response.errors.length > 0) {
                console.error('Backup errors:', response.errors);
            }
            
            if (response.success) {
                if (downloadMode && response.download_url) {
                    // Download mode: trigger download with proper filename
                    const link = document.createElement('a');
                    link.href = response.download_url;
                    if (response.download_filename) {
                        link.download = response.download_filename;
                    }
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙˆØ¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„', 'success');
                } else {
                    // Server mode
                    showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    // Switch to list tab and reload
                    $('.nav-link[data-tab="list"]').click();
                    loadBackupList();
                }
            } else {
                showNotification(response.message || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
            }
        },
        error: function(xhr) {
            $('.backup-progress').removeClass('active');
            $('#createBackupBtn').prop('disabled', false);
            
            // Debug: log error
            console.error('Backup error:', xhr);
            
            try {
                const errorData = JSON.parse(xhr.responseText);
                console.error('Error details:', errorData);
                showNotification(errorData.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
            } catch (e) {
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
            }
        }
    };
    
    $.ajax(ajaxSettings);
}

function loadBackupList() {
    $('#backupListContainer').html(`
        <div class="text-center py-5">
            <i class="fas fa-spinner fa-spin fa-3x text-muted mb-3"></i>
            <p class="text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...</p>
        </div>
    `);
    
    $.ajax({
        url: '{% url "core:backup_list" %}',
        method: 'GET',
        success: function(response) {
            if (response.success && response.backups.length > 0) {
                renderBackupList(response.backups);
            } else {
                $('#backupListContainer').html(`
                    <div class="text-center py-5">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©</p>
                    </div>
                `);
            }
        },
        error: function() {
            $('#backupListContainer').html(`
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </div>
            `);
        }
    });
}

function renderBackupList(backups) {
    let html = '<div class="table-responsive"><table class="table table-hover">';
    html += '<thead><tr>';
    html += '<th>Ø§Ø³Ù… Ø§Ù„Ù†Ø³Ø®Ø©</th>';
    html += '<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>';
    html += '<th>Ø§Ù„Ø­Ø¬Ù…</th>';
    html += '<th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª</th>';
    html += '<th class="text-center">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>';
    html += '</tr></thead><tbody>';
    
    backups.forEach(function(backup) {
        // Format date with English numbers
        const dateObj = new Date(backup.created_at);
        const date = dateObj.toLocaleString('en-US', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        });
        const size = formatFileSize(backup.total_size_bytes);
        const displayName = backup.display_name || backup.backup_id;
        
        html += '<tr>';
        html += `<td><strong>${displayName}</strong><br><small class="text-muted">${backup.backup_id}</small></td>`;
        html += `<td>${date}</td>`;
        html += `<td>${size}</td>`;
        html += `<td><span class="badge bg-info">${backup.file_count}</span></td>`;
        html += '<td class="text-center">';
        html += `<button class="btn btn-sm btn-outline-primary me-1" onclick="downloadBackup('${backup.backup_id}')" title="ØªØ­Ù…ÙŠÙ„">`;
        html += '<i class="fas fa-download"></i></button>';
        html += `<button class="btn btn-sm btn-outline-warning me-1" onclick="showRestoreModal('${backup.backup_id}')" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø©">`;
        html += '<i class="fas fa-undo"></i></button>';
        html += `<button class="btn btn-sm btn-outline-danger" onclick="deleteBackup('${backup.backup_id}')" title="Ø­Ø°Ù">`;
        html += '<i class="fas fa-trash"></i></button>';
        html += '</td></tr>';
    });
    
    html += '</tbody></table></div>';
    $('#backupListContainer').html(html);
}

function refreshBackupList() {
    loadBackupList();
}

function downloadBackup(backupId) {
    window.location.href = `/settings/backup/download/${backupId}/`;
}

function showRestoreModal(backupId) {
    $('#restoreBackupId').text(backupId);
    $('#restoreBackupIdInput').val(backupId);
    new bootstrap.Modal(document.getElementById('restoreModal')).show();
}

function confirmRestore() {
    const backupId = $('#restoreBackupIdInput').val();
    
    // Show loading state
    const modal = bootstrap.Modal.getInstance(document.getElementById('restoreModal'));
    const restoreBtn = document.querySelector('#restoreModal .btn-danger');
    const originalBtnText = restoreBtn.innerHTML;
    restoreBtn.disabled = true;
    restoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©...';
    
    $.ajax({
        url: '{% url "core:backup_restore" %}',
        method: 'POST',
        data: {
            backup_id: backupId,
            csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            modal.hide();
            restoreBtn.disabled = false;
            restoreBtn.innerHTML = originalBtnText;
            
            if (response.success) {
                const successRate = response.success_rate;
                
                let message = 'âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­';
                
                if (successRate !== null && successRate !== undefined) {
                    if (successRate < 100) {
                        message += `<br><small class="text-warning">âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${successRate.toFixed(1)}%</small>`;
                        if (successRate < 50) {
                            message += `<br><small class="text-warning">ğŸ’¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ Ø¨Ø³Ø¨Ø¨ ØªØ¹Ø§Ø±Ø¶Ø§Øª. Ø±Ø§Ø¬Ø¹ logs Ù„Ù„ØªÙØ§ØµÙŠÙ„.</small>`;
                        }
                    } else {
                        message += `<br><small class="text-success">âœ“ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ (100%)</small>`;
                    }
                }
                
                message += '<br><small>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...</small>';
                
                showNotification(message, 'success');
                
                // Reload page after 3 seconds
                setTimeout(function() {
                    window.location.reload();
                }, 3000);
            } else {
                showNotification('âŒ ' + (response.message || 'ÙØ´Ù„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©'), 'error');
            }
        },
        error: function(xhr) {
            modal.hide();
            restoreBtn.disabled = false;
            restoreBtn.innerHTML = originalBtnText;
            
            let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©';
            
            try {
                if (xhr.responseText) {
                    const errorData = JSON.parse(xhr.responseText);
                    errorMessage = errorData.message || errorMessage;
                    
                    if (errorData.error_details) {
                        console.error('Restore error details:', errorData.error_details);
                    }
                }
            } catch (e) {
                console.error('Error parsing response:', e);
            }
            
            showNotification('âŒ ' + errorMessage, 'error');
        }
    });
}

function deleteBackup(backupId) {
    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupId}ØŸ`)) {
        return;
    }
    
    $.ajax({
        url: `/settings/backup/delete/${backupId}/`,
        method: 'POST',
        data: {
            csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()
        },
        success: function(response) {
            if (response.success) {
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadBackupList();
            } else {
                showNotification(response.message || 'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
            }
        },
        error: function() {
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
        }
    });
}

function loadSettings() {
    $.ajax({
        url: '{% url "core:backup_settings" %}',
        method: 'GET',
        success: function(response) {
            if (response.success) {
                const settings = response.settings;
                
                // Database settings
                $(`input[name="db_retention_type"][value="${settings.db_retention_type || 'count'}"]`).prop('checked', true);
                $('#dbRetentionCountValue').val(settings.db_retention_count || 10);
                $('#dbRetentionDaysValue').val(settings.db_retention_days || 30);
                $('#dbAutoCleanup').prop('checked', settings.db_auto_cleanup !== false);
                
                // Full backup settings
                $(`input[name="full_retention_type"][value="${settings.full_retention_type || 'count'}"]`).prop('checked', true);
                $('#fullRetentionCountValue').val(settings.full_retention_count || 5);
                $('#fullRetentionDaysValue').val(settings.full_retention_days || 60);
                $('#fullAutoCleanup').prop('checked', settings.full_auto_cleanup !== false);
                
                // Media settings
                $(`input[name="media_retention_type"][value="${settings.media_retention_type || 'count'}"]`).prop('checked', true);
                $('#mediaRetentionCountValue').val(settings.media_retention_count || 3);
                $('#mediaRetentionDaysValue').val(settings.media_retention_days || 90);
                $('#mediaAutoCleanup').prop('checked', settings.media_auto_cleanup !== false);
                
                // Automatic backup schedule settings
                $('#enableDailyDbBackup').prop('checked', settings.enable_daily_db_backup || false);
                $('#dailyDbBackupTime').val(settings.daily_db_backup_time || '02:00');
                
                $('#enableWeeklyFullBackup').prop('checked', settings.enable_weekly_full_backup || false);
                $('#weeklyFullBackupDay').val(settings.weekly_full_backup_day || '5');
                $('#weeklyFullBackupTime').val(settings.weekly_full_backup_time || '03:00');
                
                $('#enableMonthlyMediaBackup').prop('checked', settings.enable_monthly_media_backup || false);
                $('#monthlyMediaBackupDay').val(settings.monthly_media_backup_day || '1');
                $('#monthlyMediaBackupTime').val(settings.monthly_media_backup_time || '04:00');
            }
        }
    });
}

function saveSettings() {
    const settings = {
        // Database backup settings
        db_retention_type: $('input[name="db_retention_type"]:checked').val(),
        db_retention_count: $('#dbRetentionCountValue').val(),
        db_retention_days: $('#dbRetentionDaysValue').val(),
        db_auto_cleanup: $('#dbAutoCleanup').is(':checked'),
        
        // Full backup settings
        full_retention_type: $('input[name="full_retention_type"]:checked').val(),
        full_retention_count: $('#fullRetentionCountValue').val(),
        full_retention_days: $('#fullRetentionDaysValue').val(),
        full_auto_cleanup: $('#fullAutoCleanup').is(':checked'),
        
        // Media backup settings
        media_retention_type: $('input[name="media_retention_type"]:checked').val(),
        media_retention_count: $('#mediaRetentionCountValue').val(),
        media_retention_days: $('#mediaRetentionDaysValue').val(),
        media_auto_cleanup: $('#mediaAutoCleanup').is(':checked'),
        
        // Automatic backup schedule settings
        enable_daily_db_backup: $('#enableDailyDbBackup').is(':checked'),
        daily_db_backup_time: $('#dailyDbBackupTime').val(),
        
        enable_weekly_full_backup: $('#enableWeeklyFullBackup').is(':checked'),
        weekly_full_backup_day: $('#weeklyFullBackupDay').val(),
        weekly_full_backup_time: $('#weeklyFullBackupTime').val(),
        
        enable_monthly_media_backup: $('#enableMonthlyMediaBackup').is(':checked'),
        monthly_media_backup_day: $('#monthlyMediaBackupDay').val(),
        monthly_media_backup_time: $('#monthlyMediaBackupTime').val(),
        
        csrfmiddlewaretoken: $('[name=csrfmiddlewaretoken]').val()
    };
    
    $.ajax({
        url: '{% url "core:backup_settings_update" %}',
        method: 'POST',
        data: settings,
        success: function(response) {
            if (response.success) {
                showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // Show cron setup reminder if any schedule is enabled
                if (settings.enable_daily_db_backup || settings.enable_weekly_full_backup || settings.enable_monthly_media_backup) {
                    setTimeout(function() {
                        showNotification('ğŸ’¡ Ù„Ø§ ØªÙ†Ø³Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ Cron Jobs Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©', 'info');
                    }, 2000);
                }
            } else {
                showNotification(response.message || 'ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
            }
        },
        error: function() {
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
        }
    });
}

function restoreFromUpload() {
    const formData = new FormData();
    const fileInput = document.getElementById('backupFile');
    const restoreType = $('input[name="restore_type"]:checked').val();
    
    if (!fileInput.files || fileInput.files.length === 0) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
        return;
    }
    
    const file = fileInput.files[0];
    const fileSize = file.size;
    const fileName = file.name;
    
    // Validate file size (max 500MB)
    if (fileSize > 500 * 1024 * 1024) {
        showNotification('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 500 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'error');
        return;
    }
    
    // Validate file extension
    const validExtensions = ['.sql', '.gz', '.tar', '.zip', '.db', '.sqlite3', '.json'];
    const hasValidExtension = validExtensions.some(ext => fileName.toLowerCase().endsWith(ext));
    
    if (!hasValidExtension) {
        showNotification('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: ' + validExtensions.join(', '), 'error');
        return;
    }
    
    formData.append('backup_file', file);
    formData.append('restore_type', restoreType);
    formData.append('csrfmiddlewaretoken', $('[name=csrfmiddlewaretoken]').val());
    
    $('#restoreUploadBtn').prop('disabled', true);
    $('.restore-upload-progress').show();
    $('#restoreProgressText').html(`
        <strong>Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</strong><br>
        <small>Ø§Ù„Ù…Ù„Ù: ${fileName} (${formatFileSize(fileSize)})</small><br>
        <small class="text-warning">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¹Ø¯Ù… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ ØªØ­Ø¯ÙŠØ«Ù‡Ø§</small>
    `);
    
    $.ajax({
        url: '{% url "core:backup_restore_upload" %}',
        method: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        timeout: 300000, // 5 minutes timeout
        success: function(response) {
            $('.restore-upload-progress').hide();
            $('#restoreUploadBtn').prop('disabled', false);
            
            if (response.success) {
                const components = response.restored_components || [];
                const successRate = response.success_rate;
                
                let message = 'âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­';
                
                if (successRate !== null && successRate !== undefined) {
                    if (successRate < 100) {
                        message += `<br><small class="text-warning">âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${successRate.toFixed(1)}%</small>`;
                        if (successRate < 50) {
                            message += `<br><small class="text-warning">ğŸ’¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ Ø¨Ø³Ø¨Ø¨ ØªØ¹Ø§Ø±Ø¶Ø§Øª. Ø±Ø§Ø¬Ø¹ logs Ù„Ù„ØªÙØ§ØµÙŠÙ„.</small>`;
                        }
                    } else {
                        message += `<br><small class="text-success">âœ“ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ (100%)</small>`;
                    }
                }
                
                if (components.length > 0) {
                    message += `<br><small>Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª: ${components.join(', ')}</small>`;
                }
                
                message += '<br><small>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...</small>';
                
                showNotification(message, 'success');
                
                // Reset form
                $('#restoreUploadForm')[0].reset();
                $('#confirmRestore').prop('checked', false);
                
                // Reload page after 3 seconds
                setTimeout(function() {
                    window.location.reload();
                }, 3000);
            } else {
                showNotification('âŒ ' + (response.message || 'ÙØ´Ù„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©'), 'error');
            }
        },
        error: function(xhr) {
            $('.restore-upload-progress').hide();
            $('#restoreUploadBtn').prop('disabled', false);
            
            let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©';
            let errorDetails = '';
            
            try {
                if (xhr.responseText) {
                    const errorData = JSON.parse(xhr.responseText);
                    errorMessage = errorData.message || errorMessage;
                    
                    // Show detailed error in console
                    if (errorData.error_details) {
                        console.error('Restore error details:', errorData.error_details);
                        errorDetails = '<br><small class="text-muted">ØªØ­Ù‚Ù‚ Ù…Ù† console Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„</small>';
                    }
                    
                    if (errorData.traceback) {
                        console.error('Restore error traceback:', errorData.traceback);
                    }
                }
            } catch (e) {
                console.error('Error parsing response:', e);
                console.error('Raw response:', xhr.responseText);
            }
            
            // Add helpful hints based on error
            if (errorMessage.includes('Ù…Ù„Ù') || errorMessage.includes('file')) {
                errorDetails += '<br><small>ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ­ÙŠØ­Ø© ÙˆØºÙŠØ± ØªØ§Ù„Ù</small>';
            } else if (errorMessage.includes('Ù‚Ø§Ø¹Ø¯Ø©') || errorMessage.includes('database')) {
                errorDetails += '<br><small>ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆØ§ÙÙ‚ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø¹ Ù†ÙˆØ¹ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</small>';
            }
            
            showNotification('âŒ ' + errorMessage + errorDetails, 'error');
        }
    });
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}
</script>
{% endblock %}

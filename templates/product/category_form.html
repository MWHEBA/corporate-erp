{% extends 'product/form_template.html' %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block form_content %}
<div class="row">
    <div class="col-md-6 mb-3">
        <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
        {{ form.name }}
        {% if form.name.help_text %}
            <div class="form-text">{{ form.name.help_text }}</div>
        {% endif %}
        {% if form.name.errors %}
            <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
        {% endif %}
    </div>
    <div class="col-md-6 mb-3">
        <label for="{{ form.code.id_for_label }}" class="form-label">{{ form.code.label }}</label>
        {{ form.code }}
        {% if form.code.help_text %}
            <div class="form-text">{{ form.code.help_text }}</div>
        {% endif %}
        {% if form.code.errors %}
            <div class="invalid-feedback d-block">{{ form.code.errors.0 }}</div>
        {% endif %}
    </div>
    <div class="col-md-6 mb-3">
        <label for="{{ form.parent.id_for_label }}" class="form-label">{{ form.parent.label }}</label>
        {{ form.parent }}
        {% if form.parent.help_text %}
            <div class="form-text">{{ form.parent.help_text }}</div>
        {% endif %}
        {% if form.parent.errors %}
            <div class="invalid-feedback d-block">{{ form.parent.errors.0 }}</div>
        {% endif %}
    </div>
    <div class="col-12 mb-3">
        <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
        {{ form.description }}
        {% if form.description.help_text %}
            <div class="form-text">{{ form.description.help_text }}</div>
        {% endif %}
        {% if form.description.errors %}
            <div class="invalid-feedback d-block">{{ form.description.errors.0 }}</div>
        {% endif %}
    </div>
    <div class="col-md-6 mb-3">
        <div class="form-check form-switch">
            {{ form.is_active }}
            <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                {% trans "فئة نشطة" %}
            </label>
        </div>
        {% if form.is_active.errors %}
            <div class="invalid-feedback d-block">{{ form.is_active.errors.0 }}</div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block page_js %}
<script>
    $(document).ready(function() {
        // منع اختيار التصنيف نفسها كأب
        {% if form.instance.pk %}
        const categoryId = {{ form.instance.pk }};
        
        $('#id_parent').on('change', function() {
            const selectedValue = $(this).val();
            
            if (selectedValue == categoryId) {
                alert('{% trans "لا يمكن اختيار التصنيف نفسها كفئة أب" %}');
                $(this).val('').trigger('change');
            }
        });
        {% endif %}
    });
</script>
{% endblock %} 
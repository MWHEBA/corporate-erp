{% load static %}
{% load i18n %}
{% load pricing_filters %}
{% load utils_extras %}
{% load custom_filters %}

{% comment %}
Ù…ÙƒÙˆÙ† Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ ØµÙØ­Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„ÙÙ„ØªØ±Ø©

Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
{% include "components/data_table.html" with table_id="products-table" headers=headers data=products %}

Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª:
- table_id: Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "data-table")
- headers: Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© [{'key': 'name', 'label': 'Ø§Ù„Ø§Ø³Ù…', 'sortable': True, 'width': '10%', 'class': 'text-center'}, ...] 
- data: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
- empty_message: Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶")
- table_class: ØªØµÙ†ÙŠÙØ§Øª CSS Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- primary_key: Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ…ÙØªØ§Ø­ Ø£Ø³Ø§Ø³ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "id")
- action_buttons: Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø«Ù„ [{'url': 'edit_url', 'icon': 'fa-edit', 'label': 'ØªØ¹Ø¯ÙŠÙ„', 'class': 'action-edit'}]
- responsive: Ù‡Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø³ØªØ¬ÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- sortable: Ù‡Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ±ØªÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- current_order_by: Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ±ØªÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "")
- current_order_dir: Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "")
- row_class_callback: Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„ØµÙÙˆÙ ØªØ¨Ø¹Ø§Ù‹ Ù„Ù…Ø­ØªÙˆØ§Ù‡Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- show_currency: Ù‡Ù„ ØªØ¸Ù‡Ø± Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ False)
- currency_symbol: Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)
- hover_effect: Ù‡Ù„ ØªØ¸Ù‡Ø± ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- show_search: Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- show_length_menu: Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- length_options: Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± [10, 25, 50, 100] (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- clickable_rows: Ø¬Ø¹Ù„ Ø§Ù„ØµÙÙˆÙ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ False)
- row_click_url: URL Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- show_export: Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ False)
- export_filename: Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù„Ù„ØªØµØ¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ table_data)
{% endcomment %}

{% if data %}

<div {% if responsive|default:True %}class="table-responsive"{% endif %}>
    <table id="{{ table_id|default:'data-table' }}" class="transaction-table table-hover table-striped {{ table_class }}" style="width: 100%" {% if disable_ordering %}data-disable-ordering="true"{% endif %}>
        <thead>
            <tr>
                {% for header in headers %}
                    <th {% if header.width %}style="width: {{ header.width }};"{% endif %} class="{% if header.class %}{{ header.class }}{% endif %} col-{{ header.key }} text-center">
                        <span class="d-block text-center">{{ header.label }}</span>
                    </th>
                {% endfor %}
                {% if action_buttons %}
                    <th class="text-center col-actions">{% trans "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" %}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for item in data %}
                {% if forloop.first %}<!-- DEBUG: Ù„Ø¯ÙŠÙ†Ø§ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ¹Ù„ÙŠØ© -->{% endif %}
                    <tr {% if row_class_callback %}class="{{ item|call:row_class_callback }}"{% endif %} 
                        data-id="{{ item|get_attr:primary_key|default:'0' }}"
                        {% if clickable_rows|default:False %}data-clickable="true"{% endif %}
                        {% if row_click_field %} data-url="{{ item|get_attr:row_click_field }}"{% endif %}>
                        {% for header in headers %}
                            {% with field_value=item|get_attr:header.key %}
                                <td class="{% if header.class %}{{ header.class }}{% endif %} col-{{ header.key }}">
                                    {% if header.template %}
                                        {% include header.template with value=field_value object=item %}
                                    {% elif header.format == 'date' %}
                                        {{ field_value|format_date_safe:"date"|safe }}
                                    {% elif header.format == 'datetime' %}
                                        {{ field_value|format_date_safe:"datetime"|safe }}
                                    {% elif header.format == 'datetime_12h' %}
                                        {{ field_value|format_date_safe:"datetime_12h"|safe }}
                                    {% elif header.format == 'number' %}
                                        <span class="transaction-amount {% if header.variant %}{{ header.variant }}{% endif %} text-center d-block">
                                            {% if field_value|is_empty_value %}
                                                <span class="text-muted">-</span>
                                            {% else %}
                                                {{ field_value|remove_trailing_zeros }}
                                            {% endif %}
                                        </span>
                                    {% elif header.format == 'currency' %}
                                        <span class="transaction-amount {% if header.variant %}{{ header.variant }}{% endif %} text-center d-block fw-bold">
                                            {% if field_value|is_empty_value %}
                                                <span class="text-muted">-</span>
                                            {% elif field_value == 0 and header.key == 'balance' %}
                                                <span class="text-muted">-</span>
                                            {% else %}
                                                <span class="currency-symbol">{{ currency_symbol|default:"Ø¬.Ù…" }}</span> {{ field_value|remove_trailing_zeros|default:"0" }}
                                            {% endif %}
                                        </span>
                                    {% elif header.format == 'boolean' %}
                                        {{ field_value|format_boolean_badge:header.key|safe }}
                                    {% elif header.format == 'image' %}
                                        {% if field_value %}
                                            <img src="{{ field_value.url }}" alt="ØµÙˆØ±Ø©" class="img-thumbnail" style="max-width: 50px; height: auto;">
                                        {% else %}
                                            <i class="fas fa-image text-muted"></i>
                                        {% endif %}
                                    {% elif header.format == 'role_badge' %}
                                        <div class="text-center">
                                            {% if field_value %}
                                                {% if field_value.name == 'admin' %}
                                                    <span class="badge bg-danger">
                                                        <i class="fas fa-crown me-1"></i>{{ field_value.display_name }}
                                                    </span>
                                                {% elif field_value.name == 'manager' %}
                                                    <span class="badge bg-primary">
                                                        <i class="fas fa-user-tie me-1"></i>{{ field_value.display_name }}
                                                    </span>
                                                {% elif field_value.name == 'user' %}
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-user me-1"></i>{{ field_value.display_name }}
                                                    </span>
                                                {% elif field_value.name == 'employee' %}
                                                    <span class="badge bg-info">
                                                        <i class="fas fa-user-clock me-1"></i>{{ field_value.display_name }}
                                                    </span>
                                                {% elif field_value.name == 'reception' %}
                                                    <span class="badge bg-warning text-dark">
                                                        <i class="fas fa-concierge-bell me-1"></i>{{ field_value.display_name }}
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-secondary">
                                                        <i class="fas fa-user me-1"></i>{{ field_value.display_name }}
                                                    </span>
                                                {% endif %}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </div>
                                    {% elif header.format == 'status' %}
                                        <div class="expense-status-cell">
                                            {% if header.key == 'is_active' %}
                                                {% if field_value %}
                                                    <span class="badge bg-success">{% trans "Ù†Ø´Ø·" %}</span>
                                                {% elif field_value == False %}
                                                    <span class="badge bg-danger">{% trans "ØºÙŠØ± Ù†Ø´Ø·" %}</span>
                                                {% else %}
                                                    <span class="badge bg-warning">{% trans "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" %} ({{ field_value|stringformat:'r' }})</span>
                                                {% endif %}
                                            
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ -->
                                            {% elif header.key == 'payment_status' %}
                                                {% if field_value == 'paid' %}
                                                    <span class="badge bg-success">{% trans "Ù…Ø¯ÙÙˆØ¹Ø©" %}</span>
                                                {% elif field_value == 'partially_paid' %}
                                                    <span class="badge bg-warning">{% trans "Ù…Ø¯ÙÙˆØ¹Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹" %}</span>
                                                {% elif field_value == 'unpaid' %}
                                                    <span class="badge bg-danger">{% trans "ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©" %}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                                            {% elif header.key == 'payment_method' %}
                                                {% if field_value == 'cash' %}
                                                    <span class="badge bg-success">{% trans "Ù†Ù‚Ø¯ÙŠ" %}</span>
                                                {% elif field_value == 'credit' %}
                                                    <span class="badge bg-warning">{% trans "Ø¢Ø¬Ù„" %}</span>
                                                {% elif field_value == 'bank_transfer' %}
                                                    <span class="badge bg-primary">{% trans "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ" %}</span>
                                                {% elif not field_value %}
                                                    <span class="text-muted">-</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ -->
                                            {% elif header.key == 'return_status' %}
                                                {% if field_value == 'full' %}
                                                    <span class="badge bg-danger">{% trans "Ù…Ø±ØªØ¬Ø¹ ÙƒÙ„ÙŠ" %}</span>
                                                {% elif field_value == 'partial' %}
                                                    <span class="badge bg-warning">{% trans "Ù…Ø±ØªØ¬Ø¹ Ø¬Ø²Ø¦ÙŠ" %}</span>
                                                {% elif not field_value %}
                                                    <span class="text-muted">-</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                                            {% elif header.key == 'status' and 'warehouse' in request.resolver_match.url_name %}
                                                {% if field_value == 'Ù…ØªÙˆÙØ±' %}
                                                    <span class="badge bg-success">{{ field_value }}</span>
                                                {% elif field_value == 'Ù…Ù†Ø®ÙØ¶' %}
                                                    <span class="badge bg-warning">{{ field_value }}</span>
                                                {% elif field_value == 'Ù†ÙØ¯' %}
                                                    <span class="badge bg-danger">{{ field_value }}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
                                            {% elif field_value == 'pending' %}
                                                <span class="badge bg-warning text-dark">{% trans "ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" %}</span>
                                            {% elif field_value == 'approved' %}
                                                <span class="badge bg-info">{% trans "Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡" %}</span>
                                            {% elif field_value == 'processing' %}
                                                <span class="badge bg-primary">{% trans "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" %}</span>
                                            {% elif field_value == 'completed' %}
                                                <span class="badge bg-success">{% trans "Ù…ÙƒØªÙ…Ù„" %}</span>
                                            {% elif field_value == 'failed' %}
                                                <span class="badge bg-danger">{% trans "ÙØ´Ù„" %}</span>
                                            {% elif field_value == 'rejected' %}
                                                <span class="badge bg-danger">{% trans "Ù…Ø±ÙÙˆØ¶" %}</span>
                                            {% elif field_value == 'cancelled' %}
                                                <span class="badge bg-secondary">{% trans "Ù…Ù„ØºÙŠ" %}</span>
                                            {% elif field_value == 'voided' %}
                                                <span class="badge bg-dark">{% trans "Ù…Ù„ØºÙŠ" %}</span>
                                            
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø§Øª Ù…Ø³ÙŠØ±Ø§Øª Ø§Ù„Ø±ÙˆØ§ØªØ¨ (ÙŠØ¬Ø¨ Ø£Ù† ØªØ£ØªÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³ÙˆÙŠØ§Øª) -->
                                            {% elif field_value == 'partial' %}
                                                <span class="badge bg-warning text-dark">{% trans "Ø¬Ø²Ø¦ÙŠ" %}</span>
                                            
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© -->
                                            {% elif field_value == 'posted' %}
                                                <span class="badge bg-success">Ù…Ø±Ø­Ù„</span>
                                            {% elif field_value == 'draft' %}
                                                <span class="badge bg-warning">Ù…Ø³ÙˆØ¯Ø©</span>
                                            {% elif field_value == 'paid' %}
                                                <span class="badge bg-success">{% trans "Ù…Ø¯ÙÙˆØ¹" %}</span>
                                            {% elif field_value == 'approved' %}
                                                <span class="badge bg-info">{% trans "Ù…Ø¹ØªÙ…Ø¯" %}</span>
                                            {% elif field_value == 'calculated' %}
                                                <span class="badge bg-warning">{% trans "Ù…Ø­Ø³ÙˆØ¨" %}</span>
                                            {% elif field_value == 'pending' %}
                                                <span class="badge bg-secondary">{% trans "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" %}</span>
                                            {% elif field_value == 'received' %}
                                                <span class="badge bg-success">{% trans "Ù…Ø³ØªÙ„Ù…" %}</span>
                                            {% elif field_value == 'cancelled' %}
                                                <span class="badge bg-danger">{% trans "Ù…Ù„ØºÙŠ" %}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{{ field_value }}</span>
                                            {% endif %}
                                        </div>
                                    {% elif header.format == 'reference' %}
                                        {% if field_value %}
                                            {% if header.variant == 'highlight-code' %}
                                                <div class="transaction-ref text-center">
                                                    {% if header.key == 'reference_number' or header.key == 'number' %}
                                                        {% if header.app == 'purchase' %}
                                                        <a href="{% url 'purchase:purchase_detail' item|get_attr:primary_key|default:'0' %}" class="text-decoration-none">
                                                        {% comment %}
                                                        {% elif header.app == 'sale' %}
                                                        <a href="{% url 'sale:sale_detail' item|get_attr:primary_key|default:'0' %}" class="text-decoration-none">
                                                        {% endcomment %}
                                                        {% else %}
                                                        <a href="#" class="text-decoration-none">
                                                        {% endif %}
                                                            <span class="badge invoice-number"><i class="fas fa-file-invoice me-1"></i> {{ field_value }}</span>
                                                        </a>
                                                    {% else %}
                                                        <span class="badge invoice-number"><i class="fas fa-file-invoice me-1"></i> {{ field_value }}</span>
                                                    {% endif %}
                                                </div>
                                            {% else %}
                                                <div class="transaction-ref text-center">{{ field_value }}</div>
                                            {% endif %}
                                        {% else %}
                                            <strong style="text-align: center; display: block;"><span class="text-muted">-</span></strong>
                                        {% endif %}
                                    {% elif header.key == 'reference' and 'journal' in request.resolver_match.url_name %}
                                        <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ -->
                                        {% if field_value %}
                                            <div class="transaction-ref text-center">
                                                <span class="badge bg-primary">
                                                    <i class="fas fa-book me-1"></i>{{ field_value }}
                                                </span>
                                            </div>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    {% elif header.format == 'icon_text' %}
                                        <div class="d-flex align-items-center">
                                            {% if header.icon_callback %}
                                                <div class="transaction-icon {{ item|call:header.icon_callback }}">
                                                    <i class="fas {{ item|call:header.icon_class_callback }}"></i>
                                                </div>
                                            {% endif %}
                                            <div {% if header.icon_callback %}class="transaction-type-text me-2"{% endif %}>
                                                {% if header.key == 'transaction_type' %}
                                                    {{ item|call:"get_transaction_type_display" }}
                                                {% else %}
                                                    {{ field_value }}
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% elif header.format == 'link' %}
                                        {% if header.url and field_value %}
                                            <a href="{% url header.url item|get_attr:primary_key|default:'0' %}" class="text-decoration-none fw-bold text-primary">
                                                {{ field_value }}
                                            </a>
                                        {% else %}
                                            {{ field_value|default:"-" }}
                                        {% endif %}
                                    {% elif header.format == 'html' %}
                                        {{ field_value|safe }}
                                    {% elif header.key == 'actions' %}
                                        <div class="d-flex justify-content-center">
                                            {% for button in field_value %}
                                                {% render_action_button button item primary_key %}
                                            {% endfor %}
                                        </div>
                                    {% elif header.format == 'rating' %}
                                        <div class="rating-display text-center">
                                            <div class="rating-stars text-warning mb-1">
                                                {% with rating=field_value|default:0|smart_float %}
                                                    {% for i in "12345" %}
                                                        {% if forloop.counter <= rating|add:0 %}
                                                            <i class="fas fa-star"></i>
                                                        {% else %}
                                                            <i class="far fa-star"></i>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endwith %}
                                            </div>
                                            <small class="text-muted">{{ field_value|default:0 }}/5</small>
                                        </div>
                                    {% elif header.format == 'boolean_badge' %}
                                        {% if field_value %}
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-star me-1"></i>Ù…ÙØ¶Ù„
                                            </span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    {% elif header.key == 'entry_type' %}
                                        <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ -->
                                        {% if field_value == 'Ø¥ÙŠØ±Ø§Ø¯ Ù†Ù‚Ø¯ÙŠ' %}
                                            <span class="badge bg-success">ğŸ’µ Ø¥ÙŠØ±Ø§Ø¯ Ù†Ù‚Ø¯ÙŠ</span>
                                        {% elif field_value == 'Ù…ØµØ±ÙˆÙ Ù†Ù‚Ø¯ÙŠ' %}
                                            <span class="badge bg-danger">ğŸ’¸ Ù…ØµØ±ÙˆÙ Ù†Ù‚Ø¯ÙŠ</span>
                                        {% elif field_value == 'Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ù†ÙƒÙŠ' %}
                                            <span class="badge bg-primary">ğŸ¦ Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ù†ÙƒÙŠ</span>
                                        {% elif field_value == 'Ù…ØµØ±ÙˆÙ Ø¨Ù†ÙƒÙŠ' %}
                                            <span class="badge bg-warning">ğŸ§ Ù…ØµØ±ÙˆÙ Ø¨Ù†ÙƒÙŠ</span>
                                        {% elif field_value == 'ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª' %}
                                            <span class="badge bg-success">ğŸ“„ ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                                        {% elif field_value == 'ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª' %}
                                            <span class="badge bg-info">ğŸ›’ ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª</span>
                                        {% elif field_value == 'ØªØ­ØµÙŠÙ„ Ù…Ù† Ø¹Ù…ÙŠÙ„' %}
                                            <span class="badge bg-primary">ğŸ’° ØªØ­ØµÙŠÙ„ Ù…Ù† Ø¹Ù…ÙŠÙ„</span>
                                        {% elif field_value == 'Ø¯ÙØ¹ Ù„Ù…ÙˆØ±Ø¯' %}
                                            <span class="badge bg-warning">ğŸ’³ Ø¯ÙØ¹ Ù„Ù…ÙˆØ±Ø¯</span>
                                        {% elif field_value == 'Ù‚ÙŠØ¯ Ù…Ø±ÙƒØ¨' %}
                                            <span class="badge bg-secondary">ğŸ”— Ù‚ÙŠØ¯ Ù…Ø±ÙƒØ¨</span>
                                        {% elif field_value == 'ØªØ­ÙˆÙŠÙ„' %}
                                            <span class="badge bg-info">ğŸ”„ ØªØ­ÙˆÙŠÙ„</span>
                                        {% elif field_value == 'Ø±Ø³ÙˆÙ… Ø¯Ø±Ø§Ø³ÙŠØ©' %}
                                            <span class="badge bg-success">ğŸ“ Ø±Ø³ÙˆÙ… Ø¯Ø±Ø§Ø³ÙŠØ©</span>
                                        {% elif field_value == 'Ø±Ø³ÙˆÙ… Ù…ÙˆØ§Ø¯ ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª' %}
                                            <span class="badge bg-info">ğŸ“š Ø±Ø³ÙˆÙ… Ù…ÙˆØ§Ø¯ ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª</span>
                                        {% elif field_value == 'Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø§Øª' %}
                                            <span class="badge bg-primary">ğŸ”§ Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø§Øª</span>
                                        {% elif field_value == 'Ø±Ø³ÙˆÙ… Ø¥Ø¯Ø§Ø±ÙŠØ©' %}
                                            <span class="badge bg-warning">ğŸ“‹ Ø±Ø³ÙˆÙ… Ø¥Ø¯Ø§Ø±ÙŠØ©</span>
                                        {% elif field_value == 'Ø¯ÙØ¹Ø© ÙˆÙ„ÙŠ Ø£Ù…Ø±' %}
                                            <span class="badge bg-success">ğŸ’° Ø¯ÙØ¹Ø© ÙˆÙ„ÙŠ Ø£Ù…Ø±</span>
                                        {% elif field_value == 'Ø¯ÙØ¹Ø© Ù…ÙˆØ±Ø¯' %}
                                            <span class="badge bg-danger">ğŸ’³ Ø¯ÙØ¹Ø© Ù…ÙˆØ±Ø¯</span>
                                        {% elif field_value == 'Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ' %}
                                            <span class="badge bg-success">ğŸ¤ Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ</span>
                                        {% elif field_value == 'Ø³Ø­Ø¨ Ø§Ù„Ø´Ø±ÙŠÙƒ' %}
                                            <span class="badge bg-warning">ğŸ’¼ Ø³Ø­Ø¨ Ø§Ù„Ø´Ø±ÙŠÙƒ</span>
                                        {% elif field_value == 'Ø¥ÙŠØ±Ø§Ø¯ Ù†Ù‚Ø¯ÙŠ' %}
                                            <span class="badge bg-success">ğŸ’µ Ø¥ÙŠØ±Ø§Ø¯ Ù†Ù‚Ø¯ÙŠ</span>
                                        {% elif field_value == 'Ù…ØµØ±ÙˆÙ Ù†Ù‚Ø¯ÙŠ' %}
                                            <span class="badge bg-danger">ğŸ’¸ Ù…ØµØ±ÙˆÙ Ù†Ù‚Ø¯ÙŠ</span>
                                        {% elif field_value == 'Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ù†ÙƒÙŠ' %}
                                            <span class="badge bg-primary">ğŸ¦ Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ù†ÙƒÙŠ</span>
                                        {% elif field_value == 'Ù…ØµØ±ÙˆÙ Ø¨Ù†ÙƒÙŠ' %}
                                            <span class="badge bg-warning">ğŸ§ Ù…ØµØ±ÙˆÙ Ø¨Ù†ÙƒÙŠ</span>
                                        {% elif field_value == 'ÙŠØ¯ÙˆÙŠ' %}
                                            <span class="badge bg-secondary">âœï¸ ÙŠØ¯ÙˆÙŠ</span>
                                        {% elif field_value == 'ØªÙ„Ù‚Ø§Ø¦ÙŠ' %}
                                            <span class="badge bg-info">âš™ï¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                                        {% elif field_value == 'ØªØ³ÙˆÙŠØ©' %}
                                            <span class="badge bg-warning">âš–ï¸ ØªØ³ÙˆÙŠØ©</span>
                                        {% elif field_value == 'Ø¥Ù‚ÙØ§Ù„' %}
                                            <span class="badge bg-danger">ğŸ”’ Ø¥Ù‚ÙØ§Ù„</span>
                                        {% elif field_value == 'Ø§ÙØªØªØ§Ø­ÙŠ' %}
                                            <span class="badge bg-success">ğŸ”“ Ø§ÙØªØªØ§Ø­ÙŠ</span>
                                        {% elif field_value == 'ØªØ³ÙˆÙŠØ© Ù…Ø§Ù„ÙŠØ©' %}
                                            <span class="badge bg-primary">ğŸ’¼ ØªØ³ÙˆÙŠØ© Ù…Ø§Ù„ÙŠØ©</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ field_value }}</span>
                                        {% endif %}
                                    {% else %}
                                        {% if header.ellipsis|default:False %}
                                            <div class="description">{{ field_value|default:"-" }}</div>
                                        {% else %}
                                            {% if field_value == None or field_value == '' %}
                                                <span class="text-muted">-</span>
                                            {% else %}
                                                {{ field_value }}
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                </td>
                            {% endwith %}
                        {% endfor %}
                        
                        {% if action_buttons %}
                            <td class="text-center col-actions">
                                <div class="d-flex justify-content-center">
                                    {% for button in action_buttons %}
                                        {% comment %} Ø§Ø³ØªØ®Ø¯Ø§Ù… template tag Ù…Ø­Ø³Ù† Ù„Ù„Ø£Ø²Ø±Ø§Ø± {% endcomment %}
                                        {% render_action_button button item primary_key %}
                                    {% endfor %}
                                </div>
                            </td>
                        {% endif %}
                    </tr>
                {% empty %}
                <!-- DEBUG: Ø§Ù„Ù€ for loop ÙØ§Ø±Øº - Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª -->
                <tr>
                    <td colspan="{% if action_buttons %}{{ headers|length|add:1 }}{% else %}{{ headers|length }}{% endif %}" class="text-center py-5">
                        <div class="empty-state-icon mb-3">
                            <i class="fas fa-table fa-2x text-muted" style="opacity: 0.6;"></i>
                        </div>
                        <h5 class="text-muted mb-2">{{ empty_message|default:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶" }}</h5>
                        <p class="text-muted small">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
                    </td>
                </tr>
                {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<!-- DEBUG: ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± - data={{ data|default:"None" }} -->
<!-- Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§Ø±Øº -->
<div class="empty-table-notice text-center py-5" style="border: 2px dashed #ccc; background-color: #f8f9fa;">
    <div class="empty-state-icon mb-3">
        <i class="fas fa-table fa-sm text-muted" style="opacity: 0.5;"></i>
    </div>
    <h4 class="empty-state-title text-muted mb-2">{{ empty_message|default:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶" }}</h4>
    <p class="text-muted">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
</div>
{% endif %}

{% if show_export|default:False and data %}
<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
<div class="table-export-controls mt-3">
    <div class="d-flex justify-content-end align-items-center">
        <button type="button" 
                class="btn btn-sm btn-outline-success btn-export-excel" 
                data-table="{{ table_id|default:'data-table' }}" 
                data-filename="{{ export_filename|default:'table_data' }}"
                data-date-from="{{ export_date_from|default:'' }}"
                data-date-to="{{ export_date_to|default:'' }}"
                title="ØªØµØ¯ÙŠØ± ÙƒÙ…Ù„Ù Excel"
                aria-label="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ù„Ù Excel">
            <i class="fas fa-file-excel me-1" aria-hidden="true"></i>ØªØµØ¯ÙŠØ± Excel
        </button>
    </div>
</div>
{% endif %}

<!-- Enhanced Data Table JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tableId = '{{ table_id|default:"data-table"|escapejs }}';
    const table = document.getElementById(tableId);
    if (!table) return;
    
    // Clickable Rows Functionality
    {% if clickable_rows|default:False %}
    const tableBody = table.querySelector('tbody');
    if (tableBody) {
        // Ø¥Ø¶Ø§ÙØ© event listener ÙˆØ§Ø­Ø¯ Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ÙƒÙ„ ØµÙ Ù…Ù†ÙØ±Ø¯
        tableBody.addEventListener('click', function(e) {
            const row = e.target.closest('tr[data-clickable="true"]');
            if (!row) return;
            
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø£Ùˆ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            if (e.target.closest('.col-actions, .btn, a, button, input, select, textarea')) return;
            
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
            if (row.getAttribute('data-empty') === 'true') return;
            
            const itemId = row.getAttribute('data-id');
            
            {% if row_click_field %}
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… URL Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const url = row.getAttribute('data-url');
            if (url && (url.startsWith('/') || url.startsWith(window.location.origin))) {
                window.location.href = url;
            }
            {% elif row_click_url %}
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… URL Ø«Ø§Ø¨Øª Ù…Ø¹ ID
            if (itemId && itemId !== '0' && /^\d+$/.test(itemId)) {
                const baseUrl = '{{ row_click_url|escapejs }}';
                const url = baseUrl.replace('/0/', `/${encodeURIComponent(itemId)}/`);
                if (url.startsWith('/') || url.startsWith(window.location.origin)) {
                    window.location.href = url;
                }
            }
            {% endif %}
        });
        
        // Ø¥Ø¶Ø§ÙØ© cursor pointer Ùˆhover effects Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±
        const clickableRows = tableBody.querySelectorAll('tr[data-clickable="true"]');
        clickableRows.forEach(row => {
            const itemId = row.getAttribute('data-id');
            if (itemId && itemId !== '0' && row.getAttribute('data-empty') !== 'true') {
                row.style.cursor = 'pointer';
                row.title = 'Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„';
                
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'var(--bs-light, #f8f9fa)';
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
            }
        });
    }
    {% endif %}
    
    // Export Functionality
    {% if show_export|default:False %}
    // Excel Export
    const excelBtn = document.querySelector('.btn-export-excel[data-table="' + tableId + '"]');
    if (excelBtn && !excelBtn.dataset.listenerAdded) {
        excelBtn.dataset.listenerAdded = 'true';
        excelBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            let filename = this.dataset.filename || 'table_data';
            const dateFrom = this.dataset.dateFrom;
            const dateTo = this.dataset.dateTo;
            
            // Add date range to filename if available
            if (dateFrom && dateTo) {
                filename = filename + '-' + dateFrom + '-' + dateTo;
            } else if (dateFrom) {
                filename = filename + '-from-' + dateFrom;
            } else if (dateTo) {
                filename = filename + '-to-' + dateTo;
            }
            
            exportTableToExcel(tableId, filename);
        }, { once: false });
    }
    {% endif %}
    
    // Advanced Filters Functionality
    {% if show_filters|default:False %}
    const applyFiltersBtn = document.querySelector('.btn-apply-filters[data-table="' + tableId + '"]');
    const clearFiltersBtn = document.querySelector('.btn-clear-filters[data-table="' + tableId + '"]');
    
    if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', function() {
            applyTableFilters(tableId);
        });
    }
    
    if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', function() {
            clearTableFilters(tableId);
        });
    }
    
    // Auto-apply filters on change
    const filterInputs = document.querySelectorAll('.table-filter[data-table="' + tableId + '"]');
    filterInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.value) {
                applyTableFilters(tableId);
            }
        });
    });
    {% endif %}
    
    // Column Toggle Functionality
    {% if show_column_toggle|default:False %}
    const columnToggles = document.querySelectorAll('.column-toggle[data-table="' + tableId + '"]');
    columnToggles.forEach(toggle => {
        toggle.addEventListener('change', function() {
            toggleTableColumn(tableId, this.dataset.column, this.checked);
        });
    });
    {% endif %}
});

// Export Functions
function exportTableToCSV(tableId, filename) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    let csv = [];
    const rows = table.querySelectorAll('tr');
    
    for (let i = 0; i < rows.length; i++) {
        const row = [], cols = rows[i].querySelectorAll('td, th');
        
        for (let j = 0; j < cols.length; j++) {
            // Skip action columns
            if (cols[j].classList.contains('col-actions')) continue;
            
            let cellText = cols[j].innerText.replace(/"/g, '""');
            row.push('"' + cellText + '"');
        }
        
        csv.push(row.join(','));
    }
    
    downloadCSV(csv.join('\n'), filename + '.csv');
}

function exportTableToExcel(tableId, filename) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    // Check if SheetJS is available
    if (typeof XLSX === 'undefined') {
        console.warn('SheetJS library not loaded, falling back to CSV export');
        exportTableToCSV(tableId, filename);
        return;
    }
    
    try {
        // Clone table to avoid modifying the original
        const tableClone = table.cloneNode(true);
        
        // Remove action columns
        const actionHeaders = tableClone.querySelectorAll('th.col-actions');
        const actionCells = tableClone.querySelectorAll('td.col-actions');
        actionHeaders.forEach(th => th.remove());
        actionCells.forEach(td => td.remove());
        
        // Create workbook from table
        const wb = XLSX.utils.table_to_book(tableClone, {sheet: "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"});
        
        // Add .xlsx extension if not present
        const finalFilename = filename.includes('.xlsx') ? filename : (filename + '.xlsx');
        
        // Generate Excel file and trigger download
        XLSX.writeFile(wb, finalFilename);
        
        // Show success message
        if (typeof toastr !== 'undefined') {
            toastr.success('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }
    } catch (error) {
        console.error('Error exporting to Excel:', error);
        if (typeof toastr !== 'undefined') {
            toastr.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±');
        }
    }
}

function exportTableToPDF(tableId, filename) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    // This would require a library like jsPDF
    // Fallback to print
    printTable(tableId);
}

function printTable(tableId) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</title>');
    printWindow.document.write('<style>table{border-collapse:collapse;width:100%;}th,td{border:1px solid #ddd;padding:8px;text-align:right;}th{background-color:#f2f2f2;}</style>');
    printWindow.document.write('</head><body dir="rtl">');
    printWindow.document.write(table.outerHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
}

function downloadCSV(csv, filename) {
    const csvFile = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const downloadLink = document.createElement('a');
    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = 'none';
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
}

// Filter Functions
function applyTableFilters(tableId) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    const filters = {};
    const filterInputs = document.querySelectorAll('.table-filter[data-table="' + tableId + '"]');
    
    filterInputs.forEach(input => {
        if (input.value) {
            filters[input.dataset.filter] = input.value;
        }
    });
    
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
        let showRow = true;
        
        for (const [filterKey, filterValue] of Object.entries(filters)) {
            const cell = row.querySelector(`[data-filter-key="${filterKey}"]`);
            if (cell && !cell.textContent.toLowerCase().includes(filterValue.toLowerCase())) {
                showRow = false;
                break;
            }
        }
        
        row.style.display = showRow ? '' : 'none';
    });
}

function clearTableFilters(tableId) {
    const filterInputs = document.querySelectorAll('.table-filter[data-table="' + tableId + '"]');
    filterInputs.forEach(input => {
        input.value = '';
    });
    
    const table = document.getElementById(tableId);
    if (table) {
        const rows = table.querySelectorAll('tbody tr');
        rows.forEach(row => {
            row.style.display = '';
        });
    }
}

function toggleTableColumn(tableId, columnIndex, show) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    const cells = table.querySelectorAll(`th:nth-child(${parseInt(columnIndex) + 1}), td:nth-child(${parseInt(columnIndex) + 1})`);
    cells.forEach(cell => {
        cell.style.display = show ? '' : 'none';
    });
}
</script>

<!-- Enhanced Table Styles -->
<style>
/* Export Controls */
.table-export-controls {
    padding: 1rem;
    background: var(--bs-light);
    border-radius: 0.5rem;
    border: 1px solid var(--bs-border-color);
}

.export-info {
    display: flex;
    align-items: center;
}

.export-buttons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Clickable Rows Enhancement */
tr[data-clickable="true"] {
    transition: background-color 0.2s ease;
}

tr[data-clickable="true"]:hover {
    background-color: var(--bs-light, #f8f9fa) !important;
}

tr[data-clickable="true"][style*="cursor: pointer"] {
    user-select: none;
}

/* Filter Controls */
.table-controls {
    background: var(--bs-white);
    border-radius: 0.5rem;
    padding: 1rem;
    border: 1px solid var(--bs-border-color);
}

.table-actions {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
}

.table-search-control {
    min-width: 250px;
}

/* Column Toggle */
.dropdown-menu .dropdown-item {
    padding: 0.5rem 1rem;
}

.dropdown-menu .form-check-input {
    margin-top: 0;
}

/* Responsive Design */
@media (max-width: 768px) {
    .table-controls .d-flex {
        flex-direction: column;
        align-items: stretch !important;
        gap: 1rem;
    }
    
    .table-actions {
        justify-content: stretch;
    }
    
    .table-search-control {
        min-width: auto;
        flex: 1;
    }
    
    .export-buttons .btn-group {
        width: 100%;
    }
    
    .export-buttons .btn {
        flex: 1;
    }
}
</style>

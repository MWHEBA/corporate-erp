{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load utils_extras %}

{% block title %}{{ title }} | {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/shared-components.css' %}">
<link rel="stylesheet" href="{% static 'css/unified-components.css' %}">
<link rel="stylesheet" href="{% static 'css/governance.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% csrf_token %}
    
    <!-- Page Header -->
    {% include "shared/page_header.html" with title=title subtitle=subtitle icon=icon %}
    
    <!-- Breadcrumb -->
    {% include "shared/breadcrumb.html" with items=breadcrumb_items %}
    
    <!-- System Health Score -->
    <div class="section-container">
        <h5 class="section-title"><i class="fas fa-heartbeat me-2"></i>نقاط صحة النظام</h5>
        <div class="row">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="health-score-circle">
                            <div class="score-value">{{ system_health_score|default:92 }}%</div>
                            <div class="score-label">صحة النظام العامة</div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="health-metric">
                                    <div class="metric-icon text-success"><i class="fas fa-server"></i></div>
                                    <div class="metric-value">99.8%</div>
                                    <div class="metric-label">وقت التشغيل</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="health-metric">
                                    <div class="metric-icon text-info"><i class="fas fa-tachometer-alt"></i></div>
                                    <div class="metric-value">245ms</div>
                                    <div class="metric-label">متوسط الاستجابة</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="health-metric">
                                    <div class="metric-icon text-warning"><i class="fas fa-memory"></i></div>
                                    <div class="metric-value">68%</div>
                                    <div class="metric-label">استخدام الذاكرة</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="card-title mb-0">الحالة الحالية</h6>
                    </div>
                    <div class="card-body">
                        <div class="status-item">
                            <i class="fas fa-circle text-success me-2"></i>
                            <span>قاعدة البيانات: متصلة</span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-circle text-success me-2"></i>
                            <span>النظام المالي: متصل</span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-circle text-warning me-2"></i>
                            <span>نظام البصمة: بطيء</span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-circle text-success me-2"></i>
                            <span>النسخ الاحتياطي: نشط</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Metrics -->
    <div class="section-container mb-4">
        <h5 class="section-title">
            <i class="fas fa-chart-line me-2"></i>مؤشرات الأداء
        </h5>
        <div class="row">
            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">استخدام الموارد</h6>
                    </div>
                    <div class="card-body">
                        <div class="resource-usage">
                            <div class="resource-item">
                                <div class="resource-label">المعالج (CPU)</div>
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: 45%"></div>
                                </div>
                                <div class="resource-value">45%</div>
                            </div>
                            <div class="resource-item">
                                <div class="resource-label">الذاكرة (RAM)</div>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: 68%"></div>
                                </div>
                                <div class="resource-value">68%</div>
                            </div>
                            <div class="resource-item">
                                <div class="resource-label">التخزين</div>
                                <div class="progress">
                                    <div class="progress-bar bg-info" style="width: 32%"></div>
                                </div>
                                <div class="resource-value">32%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">إحصائيات الشبكة</h6>
                    </div>
                    <div class="card-body">
                        <div class="network-stats">
                            <div class="stat-item">
                                <div class="stat-icon"><i class="fas fa-arrow-down text-success"></i></div>
                                <div class="stat-info">
                                    <div class="stat-value">1.2 MB/s</div>
                                    <div class="stat-label">سرعة التحميل</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"><i class="fas fa-arrow-up text-info"></i></div>
                                <div class="stat-info">
                                    <div class="stat-value">0.8 MB/s</div>
                                    <div class="stat-label">سرعة الرفع</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"><i class="fas fa-users text-primary"></i></div>
                                <div class="stat-info">
                                    <div class="stat-value">24</div>
                                    <div class="stat-label">مستخدمين نشطين</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Active Alerts -->
    <div class="section-container mb-4">
        <h5 class="section-title">
            <i class="fas fa-exclamation-triangle me-2"></i>التنبيهات النشطة
        </h5>
        <div class="card">
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-clock me-3"></i>
                        <div class="flex-grow-1">
                            <strong>تحذير:</strong> نظام البصمة يستجيب ببطء أكثر من المعتاد
                        </div>
                        <div>
                            <button class="btn btn-outline-warning btn-sm" onclick="resolveAlert(1)">
                                <i class="fas fa-check me-1"></i>حل
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info" role="alert">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle me-3"></i>
                        <div class="flex-grow-1">
                            <strong>معلومات:</strong> سيتم إجراء صيانة دورية للنظام غداً في الساعة 2:00 ص
                        </div>
                        <div>
                            <button class="btn btn-outline-info btn-sm" onclick="acknowledgeAlert(2)">
                                <i class="fas fa-eye me-1"></i>تم الاطلاع
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- System Services Status -->
    <div class="section-container">
        <h5 class="section-title">
            <i class="fas fa-cogs me-2"></i>حالة خدمات النظام
        </h5>
        <div class="row">
            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">الخدمات الأساسية</h6>
                    </div>
                    <div class="card-body">
                        <div class="service-status">
                            <div class="service-item">
                                <div class="service-name">خدمة قاعدة البيانات</div>
                                <div class="service-indicator">
                                    <span class="badge bg-success">نشط</span>
                                </div>
                            </div>
                            <div class="service-item">
                                <div class="service-name">خدمة الويب</div>
                                <div class="service-indicator">
                                    <span class="badge bg-success">نشط</span>
                                </div>
                            </div>
                            <div class="service-item">
                                <div class="service-name">خدمة النسخ الاحتياطي</div>
                                <div class="service-indicator">
                                    <span class="badge bg-success">نشط</span>
                                </div>
                            </div>
                            <div class="service-item">
                                <div class="service-name">خدمة الإشعارات</div>
                                <div class="service-indicator">
                                    <span class="badge bg-warning">بطيء</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">الخدمات الخارجية</h6>
                    </div>
                    <div class="card-body">
                        <div class="service-status">
                            <div class="service-item">
                                <div class="service-name">النظام المالي</div>
                                <div class="service-indicator">
                                    <span class="badge bg-success">متصل</span>
                                </div>
                            </div>
                            <div class="service-item">
                                <div class="service-name">نظام البصمة</div>
                                <div class="service-indicator">
                                    <span class="badge bg-warning">بطيء</span>
                                </div>
                            </div>
                            <div class="service-item">
                                <div class="service-name">خدمة الرسائل النصية</div>
                                <div class="service-indicator">
                                    <span class="badge bg-success">متصل</span>
                                </div>
                            </div>
                            <div class="service-item">
                                <div class="service-name">خدمة البريد الإلكتروني</div>
                                <div class="service-indicator">
                                    <span class="badge bg-success">متصل</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Auto-refresh health data every 30 seconds
    setInterval(function() {
        updateHealthMetrics();
    }, 30000);
    
    // Initialize health score animation
    animateHealthScore();
});

function updateHealthMetrics() {
    // This would fetch real-time health data
}

function animateHealthScore() {
    // Animate the health score circle
    const scoreElement = $('.score-value');
    const targetScore = parseInt(scoreElement.text());
    let currentScore = 0;
    
    const interval = setInterval(function() {
        currentScore += 2;
        scoreElement.text(currentScore + '%');
        
        if (currentScore >= targetScore) {
            clearInterval(interval);
        }
    }, 50);
}

function resolveAlert(alertId) {
    if (confirm('هل أنت متأكد من حل هذا التنبيه؟')) {
        // Resolve the alert
        alert(`تم حل التنبيه ${alertId}`);
        location.reload();
    }
}

function acknowledgeAlert(alertId) {
    // Acknowledge the alert
    alert(`تم الاطلاع على التنبيه ${alertId}`);
}
</script>
{% endblock %}
{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load utils_extras %}

{% block title %}{{ title }} | {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/shared-components.css' %}">
<link rel="stylesheet" href="{% static 'css/unified-components.css' %}">
<link rel="stylesheet" href="{% static 'css/governance.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% csrf_token %}
    
    <!-- Page Header -->
    {% include "shared/page_header.html" with title=title subtitle=subtitle icon=icon %}
    
    <!-- Breadcrumb -->
    {% include "shared/breadcrumb.html" with items=breadcrumb_items %}
    
    <!-- Security Overview -->
    <div class="section-container">
        <h5 class="section-title"><i class="fas fa-shield-alt me-2"></i>نظرة عامة على الأمان</h5>
        <div class="row">
            <div class="col-md-3 mb-3">
                <div class="stats-card stats-card-success">
                    <div class="stats-card-body">
                        <div class="stats-card-icon"><i class="fas fa-lock"></i></div>
                        <div class="stats-card-title">السياسات النشطة</div>
                        <div class="stats-card-value">12</div>
                        <div class="stats-card-unit">سياسة</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stats-card stats-card-info">
                    <div class="stats-card-body">
                        <div class="stats-card-icon"><i class="fas fa-key"></i></div>
                        <div class="stats-card-title">مفاتيح التشفير</div>
                        <div class="stats-card-value">8</div>
                        <div class="stats-card-unit">مفتاح</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stats-card stats-card-warning">
                    <div class="stats-card-body">
                        <div class="stats-card-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="stats-card-title">انتهاكات اليوم</div>
                        <div class="stats-card-value">0</div>
                        <div class="stats-card-unit">انتهاك</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stats-card stats-card-primary">
                    <div class="stats-card-body">
                        <div class="stats-card-icon"><i class="fas fa-user-shield"></i></div>
                        <div class="stats-card-title">مستوى الأمان</div>
                        <div class="stats-card-value">عالي</div>
                        <div class="stats-card-unit">مستوى</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Security Policies Management -->
    <div class="section-container mb-4">
        <h5 class="section-title" data-bs-toggle="collapse" data-bs-target="#securityPolicies" aria-expanded="true">
            <i class="fas fa-file-shield me-2"></i>إدارة السياسات الأمنية<i class="fas fa-chevron-down float-end"></i>
        </h5>
        <div class="collapse show" id="securityPolicies">
            <div class="row">
                <div class="col-lg-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-user-lock me-2"></i>سياسات المصادقة
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>كلمات المرور القوية</strong>
                                        <br><small class="text-muted">الحد الأدنى 8 أحرف مع رموز خاصة</small>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>انتهاء صلاحية كلمة المرور</strong>
                                        <br><small class="text-muted">كل 90 يوم</small>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>قفل الحساب</strong>
                                        <br><small class="text-muted">بعد 5 محاولات فاشلة</small>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-outline-primary btn-sm" onclick="editAuthPolicies()">
                                    <i class="fas fa-edit me-1"></i>تعديل السياسات
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-network-wired me-2"></i>سياسات الشبكة
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>تشفير HTTPS</strong>
                                        <br><small class="text-muted">إجباري لجميع الاتصالات</small>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>جدار الحماية</strong>
                                        <br><small class="text-muted">حماية من الهجمات الخارجية</small>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>مراقبة الشبكة</strong>
                                        <br><small class="text-muted">تسجيل جميع الاتصالات</small>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-outline-primary btn-sm" onclick="editNetworkPolicies()">
                                    <i class="fas fa-edit me-1"></i>تعديل السياسات
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Encryption Management -->
    <div class="section-container mb-4">
        <h5 class="section-title" data-bs-toggle="collapse" data-bs-target="#encryptionManagement" aria-expanded="false">
            <i class="fas fa-key me-2"></i>إدارة التشفير<i class="fas fa-chevron-down float-end"></i>
        </h5>
        <div class="collapse" id="encryptionManagement">
            <div class="row">
                <div class="col-lg-8 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-key me-2"></i>مفاتيح التشفير النشطة
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th class="text-center">اسم المفتاح</th>
                                            <th class="text-center">النوع</th>
                                            <th class="text-center">تاريخ الإنشاء</th>
                                            <th class="text-center">تاريخ الانتهاء</th>
                                            <th class="text-center">الحالة</th>
                                            <th class="text-center">الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center"><code>DATABASE_KEY</code></td>
                                            <td class="text-center">AES-256</td>
                                            <td class="text-center">2024-01-15</td>
                                            <td class="text-center">2025-01-15</td>
                                            <td class="text-center"><span class="badge bg-success">نشط</span></td>
                                            <td class="text-center">
                                                <button class="btn btn-outline-warning btn-sm" onclick="rotateKey('DATABASE_KEY')">
                                                    <i class="fas fa-sync me-1"></i>تدوير
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-center"><code>SESSION_KEY</code></td>
                                            <td class="text-center">AES-128</td>
                                            <td class="text-center">2024-02-01</td>
                                            <td class="text-center">2024-08-01</td>
                                            <td class="text-center"><span class="badge bg-warning">قريب الانتهاء</span></td>
                                            <td class="text-center">
                                                <button class="btn btn-outline-warning btn-sm" onclick="rotateKey('SESSION_KEY')">
                                                    <i class="fas fa-sync me-1"></i>تدوير
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-center"><code>API_KEY</code></td>
                                            <td class="text-center">RSA-2048</td>
                                            <td class="text-center">2024-01-01</td>
                                            <td class="text-center">2025-01-01</td>
                                            <td class="text-center"><span class="badge bg-success">نشط</span></td>
                                            <td class="text-center">
                                                <button class="btn btn-outline-warning btn-sm" onclick="rotateKey('API_KEY')">
                                                    <i class="fas fa-sync me-1"></i>تدوير
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4 mb-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-plus me-2"></i>إنشاء مفتاح جديد
                            </h6>
                        </div>
                        <div class="card-body">
                            <form id="newKeyForm">
                                <div class="mb-3">
                                    <label class="form-label">اسم المفتاح</label>
                                    <input type="text" class="form-control" id="keyName" placeholder="مثال: BACKUP_KEY">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">نوع التشفير</label>
                                    <select class="form-select" id="keyType">
                                        <option value="AES-256">AES-256</option>
                                        <option value="AES-128">AES-128</option>
                                        <option value="RSA-2048">RSA-2048</option>
                                        <option value="RSA-4096">RSA-4096</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">مدة الصلاحية (أشهر)</label>
                                    <input type="number" class="form-control" id="keyDuration" value="12" min="1" max="24">
                                </div>
                                <button type="button" class="btn btn-primary w-100" onclick="generateNewKey()">
                                    <i class="fas fa-key me-1"></i>إنشاء المفتاح
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Security Monitoring -->
    <div class="section-container mb-4">
        <h5 class="section-title" data-bs-toggle="collapse" data-bs-target="#securityMonitoring" aria-expanded="false">
            <i class="fas fa-eye me-2"></i>مراقبة الأمان<i class="fas fa-chevron-down float-end"></i>
        </h5>
        <div class="collapse" id="securityMonitoring">
            <div class="row">
                <div class="col-lg-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-chart-line me-2"></i>إحصائيات الأمان
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6 mb-3">
                                    <div class="metric-box">
                                        <div class="metric-value text-success">1,247</div>
                                        <div class="metric-label">تسجيلات دخول ناجحة</div>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="metric-box">
                                        <div class="metric-value text-warning">23</div>
                                        <div class="metric-label">محاولات فاشلة</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-box">
                                        <div class="metric-value text-info">156</div>
                                        <div class="metric-label">جلسات نشطة</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-box">
                                        <div class="metric-value text-danger">0</div>
                                        <div class="metric-label">حسابات مقفلة</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-shield-alt me-2"></i>حالة الحماية
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>جدار الحماية</strong>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>مكافح الفيروسات</strong>
                                    </div>
                                    <span class="badge bg-success">محدث</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>تشفير البيانات</strong>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>مراقبة الشبكة</strong>
                                    </div>
                                    <span class="badge bg-success">نشط</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="section-container">
        <h5 class="section-title"><i class="fas fa-bolt me-2"></i>إجراءات سريعة</h5>
        <div class="row">
            <div class="col-md-3 mb-2">
                <button class="btn btn-outline-primary w-100" onclick="runSecurityScan()">
                    <i class="fas fa-search me-2"></i>فحص أمني شامل
                </button>
            </div>
            <div class="col-md-3 mb-2">
                <button class="btn btn-outline-warning w-100" onclick="rotateAllKeys()">
                    <i class="fas fa-sync me-2"></i>تدوير جميع المفاتيح
                </button>
            </div>
            <div class="col-md-3 mb-2">
                <button class="btn btn-outline-info w-100" onclick="exportSecurityReport()">
                    <i class="fas fa-download me-2"></i>تقرير الأمان
                </button>
            </div>
            <div class="col-md-3 mb-2">
                <button class="btn btn-outline-success w-100" onclick="updateSecurityPolicies()">
                    <i class="fas fa-shield-alt me-2"></i>تحديث السياسات
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/global-table.js' %}"></script>
<script>
$(document).ready(function() {
    // Initialize collapsible sections
    $('.section-title[data-bs-toggle="collapse"]').on('click', function() {
        const icon = $(this).find('.fa-chevron-down');
        const isExpanded = $(this).attr('aria-expanded') === 'true';
        
        if (isExpanded) {
            icon.removeClass('fa-chevron-down').addClass('fa-chevron-up');
        } else {
            icon.removeClass('fa-chevron-up').addClass('fa-chevron-down');
        }
    });
});

function editAuthPolicies() {
    alert('سيتم فتح نافذة تعديل سياسات المصادقة');
}

function editNetworkPolicies() {
    alert('سيتم فتح نافذة تعديل سياسات الشبكة');
}

function rotateKey(keyName) {
    if (confirm(`هل أنت متأكد من تدوير المفتاح ${keyName}؟`)) {
        alert(`جاري تدوير المفتاح ${keyName}...`);
    }
}

function generateNewKey() {
    const keyName = document.getElementById('keyName').value;
    const keyType = document.getElementById('keyType').value;
    const keyDuration = document.getElementById('keyDuration').value;
    
    if (!keyName) {
        alert('يرجى إدخال اسم المفتاح');
        return;
    }
    
    if (confirm(`إنشاء مفتاح جديد: ${keyName} (${keyType})`)) {
        alert('جاري إنشاء المفتاح...');
        document.getElementById('newKeyForm').reset();
    }
}

function runSecurityScan() {
    alert('جاري تشغيل الفحص الأمني الشامل...');
}

function rotateAllKeys() {
    if (confirm('هل أنت متأكد من تدوير جميع المفاتيح؟ هذا قد يؤثر على النظام مؤقتاً.')) {
        alert('جاري تدوير جميع المفاتيح...');
    }
}

function exportSecurityReport() {
    alert('جاري تصدير تقرير الأمان...');
}

function updateSecurityPolicies() {
    if (confirm('هل تريد تحديث جميع السياسات الأمنية؟')) {
        alert('جاري تحديث السياسات الأمنية...');
    }
}
</script>
{% endblock %}
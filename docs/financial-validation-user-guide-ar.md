# دليل المستخدم - نظام التحقق من المعاملات المالية

## نظرة عامة

نظام التحقق من المعاملات المالية هو آلية حماية شاملة تضمن سلامة جميع المعاملات المالية في النظام. يتحقق النظام تلقائياً من توفر الشروط المحاسبية الأساسية قبل السماح بأي معاملة مالية.

### ما الذي يتحقق منه النظام؟

1. **الحساب المحاسبي**: التأكد من وجود حساب محاسبي صحيح ومفعّل لكل كيان مالي
2. **الفترة المحاسبية**: التأكد من وجود فترة محاسبية مفتوحة لتاريخ المعاملة

### لماذا هذا النظام مهم؟

- **منع الأخطاء المحاسبية**: يمنع إدخال معاملات بدون حسابات محاسبية
- **حماية البيانات**: يمنع التعديل على فترات محاسبية مغلقة
- **الامتثال المحاسبي**: يضمن الالتزام بالمعايير المحاسبية
- **سهولة التدقيق**: يسجل جميع المحاولات المرفوضة للمراجعة

---

## الجزء الأول: إعداد الحسابات المحاسبية

### ما هو الحساب المحاسبي؟

الحساب المحاسبي هو رمز فريد في دليل الحسابات يُستخدم لتصنيف وتتبع المعاملات المالية.

### متطلبات الحساب المحاسبي

لكي يكون الحساب المحاسبي صالحاً للاستخدام، يجب أن يستوفي الشروط التالية:

1. ✅ **موجود**: يجب أن يكون الحساب مُنشأ في دليل الحسابات
2. ✅ **مفعّل**: يجب أن تكون حالة الحساب "مفعّل" (is_active = True)
3. ✅ **حساب نهائي**: يجب أن يكون حساباً نهائياً وليس حساباً رئيسياً (is_leaf = True)


### دليل خطوة بخطوة: إعداد حساب محاسبي لطالب

#### الخطوة 1: الانتقال إلى دليل الحسابات

1. من القائمة الرئيسية، اختر **المالية**
2. اختر **دليل الحسابات**
3. ستظهر لك قائمة بجميع الحسابات المحاسبية

#### الخطوة 2: إنشاء حساب محاسبي جديد (إذا لزم الأمر)

1. انقر على زر **إضافة حساب جديد**
2. املأ البيانات التالية:
   - **الرمز**: رمز فريد للحساب (مثال: 1201001)
   - **الاسم**: اسم واضح للحساب (مثال: "حساب الطالب - أحمد محمد")
   - **النوع**: اختر النوع المناسب (مثال: "أصول متداولة - ذمم مدينة")
   - **الحساب الأب**: اختر الحساب الرئيسي المناسب
   - **حساب نهائي**: ✅ تأكد من تفعيل هذا الخيار
   - **مفعّل**: ✅ تأكد من تفعيل هذا الخيار
3. انقر على **حفظ**

#### الخطوة 3: ربط الحساب المحاسبي بالطالب

1. انتقل إلى **الطلاب** > **قائمة الطلاب**
2. ابحث عن الطالب المطلوب
3. انقر على **تعديل**
4. في قسم **المعلومات المالية**:
   - اختر **الحساب المحاسبي** من القائمة المنسدلة
   - اختر الحساب الذي أنشأته في الخطوة السابقة
5. انقر على **حفظ**

#### الخطوة 4: التحقق من الإعداد

1. حاول إنشاء دفعة جديدة للطالب
2. إذا كان الإعداد صحيحاً، ستتم المعاملة بنجاح
3. إذا ظهرت رسالة خطأ، راجع الخطوات السابقة


### دليل خطوة بخطوة: إعداد حساب محاسبي لمورد

#### الخطوة 1: إنشاء حساب محاسبي للمورد

1. انتقل إلى **المالية** > **دليل الحسابات**
2. انقر على **إضافة حساب جديد**
3. املأ البيانات:
   - **الرمز**: مثال: 2101001
   - **الاسم**: "حساب المورد - [اسم المورد]"
   - **النوع**: "خصوم متداولة - ذمم دائنة"
   - **الحساب الأب**: اختر حساب الموردين الرئيسي
   - **حساب نهائي**: ✅ مفعّل
   - **مفعّل**: ✅ مفعّل
4. احفظ الحساب

#### الخطوة 2: ربط الحساب بالمورد

1. انتقل إلى **الموردين** > **قائمة الموردين**
2. اختر المورد المطلوب
3. في صفحة التعديل، اختر **الحساب المحاسبي**
4. احفظ التغييرات

### دليل خطوة بخطوة: إعداد حساب محاسبي لموظف

#### الخطوة 1: إنشاء حساب محاسبي للموظف

1. انتقل إلى **المالية** > **دليل الحسابات**
2. أنشئ حساباً جديداً:
   - **الرمز**: مثال: 2201001
   - **الاسم**: "حساب الموظف - [اسم الموظف]"
   - **النوع**: "خصوم متداولة - رواتب مستحقة"
   - **حساب نهائي**: ✅ مفعّل
   - **مفعّل**: ✅ مفعّل

#### الخطوة 2: ربط الحساب بالموظف

1. انتقل إلى **الموارد البشرية** > **الموظفين**
2. اختر الموظف وقم بتعديل بياناته
3. اختر الحساب المحاسبي المناسب
4. احفظ التغييرات


### دليل خطوة بخطوة: إعداد حساب محاسبي لنشاط

#### الخطوة 1: إنشاء حساب إيرادات للنشاط

1. انتقل إلى **المالية** > **دليل الحسابات**
2. أنشئ حساباً جديداً:
   - **الرمز**: مثال: 4101001
   - **الاسم**: "إيرادات نشاط - [اسم النشاط]"
   - **النوع**: "إيرادات"
   - **حساب نهائي**: ✅ مفعّل
   - **مفعّل**: ✅ مفعّل

#### الخطوة 2: ربط الحساب بالنشاط

1. انتقل إلى **الأنشطة** > **قائمة الأنشطة**
2. اختر النشاط المطلوب
3. في صفحة التعديل، اختر **حساب الإيرادات**
4. احفظ التغييرات

### دليل خطوة بخطوة: إعداد حساب محاسبي لخط نقل

#### الخطوة 1: إنشاء حساب إيرادات لخط النقل

1. انتقل إلى **المالية** > **دليل الحسابات**
2. أنشئ حساباً جديداً:
   - **الرمز**: مثال: 4201001
   - **الاسم**: "إيرادات نقل - [اسم الخط]"
   - **النوع**: "إيرادات"
   - **حساب نهائي**: ✅ مفعّل
   - **مفعّل**: ✅ مفعّل

#### الخطوة 2: ربط الحساب بخط النقل

1. انتقل إلى **النقل** > **خطوط النقل**
2. اختر خط النقل المطلوب
3. في صفحة التعديل، اختر **حساب الإيرادات**
4. احفظ التغييرات

---


## الجزء الثاني: إدارة الفترات المحاسبية

### ما هي الفترة المحاسبية؟

الفترة المحاسبية هي فترة زمنية محددة (عادة شهر أو سنة) يتم خلالها تسجيل المعاملات المالية. بعد انتهاء الفترة، يتم إغلاقها لمنع التعديلات.

### حالات الفترة المحاسبية

1. **مفتوحة (Open)**: يمكن إدخال معاملات جديدة
2. **مغلقة (Closed)**: لا يمكن إدخال معاملات جديدة (محمية)

### دليل خطوة بخطوة: إنشاء فترة محاسبية جديدة

#### الخطوة 1: الانتقال إلى الفترات المحاسبية

1. من القائمة الرئيسية، اختر **المالية**
2. اختر **الفترات المحاسبية**
3. ستظهر لك قائمة بجميع الفترات المحاسبية

#### الخطوة 2: إنشاء فترة جديدة

1. انقر على زر **إضافة فترة محاسبية**
2. املأ البيانات التالية:
   - **الاسم**: اسم واضح للفترة (مثال: "يناير 2024" أو "السنة المالية 2024")
   - **تاريخ البداية**: أول يوم في الفترة (مثال: 2024-01-01)
   - **تاريخ النهاية**: آخر يوم في الفترة (مثال: 2024-01-31)
   - **الحالة**: اختر **مفتوحة**
   - **الوصف**: وصف اختياري للفترة
3. انقر على **حفظ**

#### الخطوة 3: التحقق من الفترة

1. تأكد من ظهور الفترة في القائمة
2. تأكد من أن حالتها "مفتوحة"
3. تأكد من عدم تداخل التواريخ مع فترات أخرى


### دليل خطوة بخطوة: إغلاق فترة محاسبية

#### متى يجب إغلاق الفترة؟

- بعد انتهاء الفترة الزمنية
- بعد مراجعة جميع المعاملات
- بعد إعداد التقارير المالية
- قبل بداية فترة محاسبية جديدة

#### خطوات الإغلاق

1. انتقل إلى **المالية** > **الفترات المحاسبية**
2. اختر الفترة المطلوب إغلاقها
3. انقر على **تعديل**
4. غيّر **الحالة** من "مفتوحة" إلى **مغلقة**
5. انقر على **حفظ**

⚠️ **تحذير**: بعد إغلاق الفترة، لن يمكن إدخال أي معاملات جديدة بتواريخ تقع ضمن هذه الفترة.

### دليل خطوة بخطوة: إعادة فتح فترة محاسبية

في حالات استثنائية، قد تحتاج لإعادة فتح فترة مغلقة:

1. انتقل إلى **المالية** > **الفترات المحاسبية**
2. اختر الفترة المغلقة
3. انقر على **تعديل**
4. غيّر **الحالة** من "مغلقة" إلى **مفتوحة**
5. انقر على **حفظ**

⚠️ **ملاحظة**: يجب أن يكون لديك صلاحيات خاصة لإعادة فتح فترة مغلقة.

### أفضل الممارسات للفترات المحاسبية

1. **أنشئ الفترات مسبقاً**: أنشئ فترات السنة كاملة في بداية السنة المالية
2. **لا تتداخل الفترات**: تأكد من عدم تداخل تواريخ الفترات
3. **أغلق الفترات بانتظام**: أغلق كل فترة بعد انتهائها ومراجعتها
4. **وثّق الإغلاق**: احتفظ بسجل لتواريخ إغلاق الفترات
5. **راجع قبل الإغلاق**: تأكد من صحة جميع المعاملات قبل الإغلاق

---


## الجزء الثالث: رسائل الخطأ وكيفية حلها

### رسالة: "لا يوجد حساب محاسبي مرتبط بـ [اسم الكيان]"

#### الوصف
هذه الرسالة تظهر عندما تحاول إجراء معاملة مالية لكيان (طالب، مورد، موظف، إلخ) ليس له حساب محاسبي مرتبط.

#### مثال
```
❌ لا يوجد حساب محاسبي مرتبط بـ الطالب: أحمد محمد علي
يرجى إنشاء حساب محاسبي وربطه بالطالب قبل إجراء أي معاملات مالية.
```

#### الحل

**الخطوة 1**: أنشئ حساباً محاسبياً جديداً
- انتقل إلى **المالية** > **دليل الحسابات**
- أنشئ حساباً جديداً بالمواصفات المطلوبة
- تأكد من تفعيل "حساب نهائي" و "مفعّل"

**الخطوة 2**: اربط الحساب بالكيان
- انتقل إلى صفحة تعديل الكيان (الطالب، المورد، إلخ)
- اختر الحساب المحاسبي من القائمة المنسدلة
- احفظ التغييرات

**الخطوة 3**: أعد المحاولة
- ارجع إلى المعاملة المالية وأعد المحاولة

---

### رسالة: "الحساب المحاسبي [كود - اسم] غير مفعّل"

#### الوصف
هذه الرسالة تظهر عندما يكون الحساب المحاسبي المرتبط بالكيان موجوداً لكنه غير مفعّل.

#### مثال
```
❌ الحساب المحاسبي 1201001 - حساب الطالب أحمد محمد غير مفعّل
يرجى تفعيل الحساب المحاسبي قبل إجراء المعاملات المالية.
```

#### الحل

**الخطوة 1**: انتقل إلى دليل الحسابات
- **المالية** > **دليل الحسابات**

**الخطوة 2**: ابحث عن الحساب
- استخدم البحث للعثور على الحساب بالكود أو الاسم

**الخطوة 3**: فعّل الحساب
- انقر على **تعديل**
- فعّل خيار **مفعّل** (is_active)
- احفظ التغييرات

**الخطوة 4**: أعد المحاولة
- ارجع إلى المعاملة المالية وأعد المحاولة


---

### رسالة: "الحساب المحاسبي [كود - اسم] ليس حساباً نهائياً"

#### الوصف
هذه الرسالة تظهر عندما يكون الحساب المحاسبي المرتبط حساباً رئيسياً (Parent Account) وليس حساباً نهائياً (Leaf Account).

#### مثال
```
❌ الحساب المحاسبي 1200 - الذمم المدينة ليس حساباً نهائياً
لا يمكن إجراء معاملات مالية على الحسابات الرئيسية. يرجى استخدام حساب نهائي.
```

#### الحل

**الخيار 1**: استخدم حساباً نهائياً موجوداً
- ابحث عن حساب نهائي تحت نفس الحساب الرئيسي
- اربط الكيان بالحساب النهائي

**الخيار 2**: أنشئ حساباً نهائياً جديداً
- انتقل إلى **المالية** > **دليل الحسابات**
- أنشئ حساباً جديداً
- اختر الحساب الرئيسي الحالي كـ "الحساب الأب"
- ✅ فعّل خيار **حساب نهائي**
- احفظ واربط الكيان بالحساب الجديد

---

### رسالة: "لا توجد فترة محاسبية للتاريخ [التاريخ]"

#### الوصف
هذه الرسالة تظهر عندما تحاول إجراء معاملة مالية بتاريخ لا يقع ضمن أي فترة محاسبية.

#### مثال
```
❌ لا توجد فترة محاسبية للتاريخ 2024-06-15
يرجى إنشاء فترة محاسبية تشمل هذا التاريخ قبل إجراء المعاملة.
```

#### الحل

**الخطوة 1**: تحقق من الفترات الموجودة
- انتقل إلى **المالية** > **الفترات المحاسبية**
- تحقق من التواريخ المغطاة

**الخطوة 2**: أنشئ فترة محاسبية جديدة
- انقر على **إضافة فترة محاسبية**
- حدد تاريخ البداية والنهاية بحيث يشمل تاريخ المعاملة
- اختر الحالة **مفتوحة**
- احفظ الفترة

**الخطوة 3**: أعد المحاولة
- ارجع إلى المعاملة المالية وأعد المحاولة


---

### رسالة: "الفترة المحاسبية [اسم الفترة] مغلقة"

#### الوصف
هذه الرسالة تظهر عندما تحاول إجراء معاملة مالية بتاريخ يقع ضمن فترة محاسبية مغلقة.

#### مثال
```
❌ الفترة المحاسبية يناير 2024 مغلقة
لا يمكن إجراء معاملات مالية في فترة مغلقة. يرجى استخدام فترة مفتوحة أو إعادة فتح الفترة.
```

#### الحل

**الخيار 1**: استخدم تاريخاً في فترة مفتوحة (الحل الموصى به)
- غيّر تاريخ المعاملة إلى تاريخ يقع في فترة مفتوحة
- أعد المحاولة

**الخيار 2**: أعد فتح الفترة المغلقة (للحالات الاستثنائية فقط)
- انتقل إلى **المالية** > **الفترات المحاسبية**
- اختر الفترة المغلقة
- غيّر الحالة إلى **مفتوحة**
- احفظ التغييرات
- ⚠️ **تحذير**: يتطلب صلاحيات خاصة ويجب توثيق السبب

---

### رسالة: "حدث خطأ في التحقق من المعاملة المالية"

#### الوصف
رسالة خطأ عامة قد تظهر عند وجود مشكلة غير متوقعة.

#### الحل

1. **تحقق من البيانات**: تأكد من صحة جميع البيانات المدخلة
2. **راجع السجلات**: تحقق من سجل التدقيق لمعرفة التفاصيل
3. **اتصل بالدعم الفني**: إذا استمرت المشكلة، اتصل بمسؤول النظام

---


## الجزء الرابع: سيناريوهات عملية

### السيناريو 1: تسجيل دفعة طالب جديد

#### الموقف
لديك طالب جديد يريد دفع رسوم التسجيل، لكن عند محاولة تسجيل الدفعة تظهر رسالة خطأ.

#### الخطوات

1. **تحقق من الحساب المحاسبي**
   - انتقل إلى صفحة الطالب
   - تحقق من وجود حساب محاسبي مرتبط
   - إذا لم يكن موجوداً، أنشئ حساباً جديداً واربطه

2. **تحقق من الفترة المحاسبية**
   - تأكد من وجود فترة محاسبية مفتوحة لتاريخ الدفعة
   - إذا لم تكن موجودة، أنشئ فترة جديدة

3. **سجّل الدفعة**
   - ارجع إلى صفحة تسجيل الدفعة
   - أدخل البيانات المطلوبة
   - احفظ الدفعة

### السيناريو 2: دفع مستحقات مورد

#### الموقف
تريد دفع مستحقات مورد عن فاتورة سابقة.

#### الخطوات

1. **تحقق من حساب المورد**
   - انتقل إلى **الموردين** > اختر المورد
   - تأكد من وجود حساب محاسبي مرتبط
   - تأكد من أن الحساب مفعّل وحساب نهائي

2. **تحقق من الفترة المحاسبية**
   - تأكد من وجود فترة مفتوحة لتاريخ الدفع

3. **سجّل الدفعة**
   - انتقل إلى صفحة دفع المستحقات
   - أدخل المبلغ والتاريخ
   - احفظ الدفعة


### السيناريو 3: صرف راتب موظف

#### الموقف
حان موعد صرف رواتب الموظفين الشهرية.

#### الخطوات

1. **تحقق من حسابات الموظفين**
   - انتقل إلى **الموارد البشرية** > **الموظفين**
   - تأكد من أن جميع الموظفين لديهم حسابات محاسبية
   - تأكد من أن الحسابات مفعّلة

2. **تحقق من الفترة المحاسبية**
   - تأكد من وجود فترة مفتوحة لشهر الراتب

3. **صرف الرواتب**
   - انتقل إلى صفحة صرف الرواتب
   - اختر الموظفين
   - أدخل المبالغ والتاريخ
   - احفظ العملية

### السيناريو 4: تسجيل رسوم نشاط

#### الموقف
تريد تسجيل رسوم نشاط رياضي للطلاب المشاركين.

#### الخطوات

1. **تحقق من حساب النشاط**
   - انتقل إلى **الأنشطة** > اختر النشاط
   - تأكد من وجود حساب إيرادات مرتبط
   - تأكد من أن الحساب مفعّل

2. **تحقق من حسابات الطلاب**
   - تأكد من أن جميع الطلاب المشاركين لديهم حسابات محاسبية

3. **تحقق من الفترة المحاسبية**
   - تأكد من وجود فترة مفتوحة

4. **سجّل الرسوم**
   - انتقل إلى صفحة تسجيل رسوم النشاط
   - اختر الطلاب والمبالغ
   - احفظ العملية

---


## الجزء الخامس: الأسئلة الشائعة

### س1: هل يمكنني إجراء معاملة مالية بدون حساب محاسبي؟

**ج**: لا، النظام يمنع أي معاملة مالية بدون حساب محاسبي صحيح. هذا لضمان سلامة البيانات المحاسبية.

### س2: ماذا أفعل إذا نسيت إنشاء فترة محاسبية للشهر الحالي؟

**ج**: يمكنك إنشاء الفترة في أي وقت:
1. انتقل إلى **المالية** > **الفترات المحاسبية**
2. أنشئ فترة جديدة للشهر الحالي
3. تأكد من أن الحالة "مفتوحة"
4. بعد ذلك يمكنك إجراء المعاملات

### س3: هل يمكنني تعديل معاملة في فترة مغلقة؟

**ج**: لا، الفترات المغلقة محمية من التعديل. إذا كنت بحاجة ماسة للتعديل:
1. اتصل بمسؤول النظام
2. يمكن إعادة فتح الفترة مؤقتاً (يتطلب صلاحيات خاصة)
3. بعد التعديل، يجب إغلاق الفترة مرة أخرى

### س4: لماذا لا يمكنني استخدام حساب رئيسي للمعاملات؟

**ج**: الحسابات الرئيسية (Parent Accounts) تُستخدم للتصنيف فقط. المعاملات المالية يجب أن تُسجل على الحسابات النهائية (Leaf Accounts) لضمان دقة التقارير.

### س5: كم عدد الفترات المحاسبية التي يمكن أن تكون مفتوحة في نفس الوقت؟

**ج**: يمكن أن يكون لديك عدة فترات مفتوحة، لكن يُنصح بفتح فترة واحدة فقط (الفترة الحالية) لتجنب الأخطاء.

### س6: ماذا يحدث إذا حاولت إجراء معاملة مرفوضة عدة مرات؟

**ج**: النظام يسجل جميع المحاولات المرفوضة. إذا تكررت المحاولات (أكثر من 3 مرات في ساعة)، سيتم إرسال إشعار للمسؤولين الماليين.

### س7: هل يمكنني حذف حساب محاسبي مرتبط بكيان؟

**ج**: لا يُنصح بحذف الحسابات المرتبطة. بدلاً من ذلك:
1. قم بتعطيل الحساب (is_active = False)
2. أو أنشئ حساباً جديداً واربطه بالكيان


### س8: كيف أعرف إذا كان الحساب المحاسبي نهائياً أم رئيسياً؟

**ج**: في صفحة تفاصيل الحساب أو قائمة الحسابات، ابحث عن:
- ✅ **حساب نهائي**: يمكن استخدامه للمعاملات
- ❌ **حساب رئيسي**: للتصنيف فقط، لا يمكن استخدامه للمعاملات

### س9: ماذا أفعل إذا ظهرت رسالة خطأ غير مفهومة؟

**ج**: 
1. اقرأ الرسالة بعناية - عادة تحتوي على تفاصيل المشكلة
2. راجع هذا الدليل للحلول الشائعة
3. تحقق من سجل التدقيق في لوحة التحكم
4. اتصل بمسؤول النظام إذا استمرت المشكلة

### س10: هل يؤثر نظام التحقق على سرعة النظام؟

**ج**: لا، النظام مُحسّن للأداء ويستخدم:
- فهرسة قاعدة البيانات
- تخزين مؤقت للبيانات المتكررة
- استعلامات محسّنة

معظم عمليات التحقق تتم في أقل من 100 ميلي ثانية.

---

## الجزء السادس: نصائح وأفضل الممارسات

### للمحاسبين

1. **أنشئ الحسابات مسبقاً**
   - أنشئ حسابات محاسبية لجميع الكيانات الجديدة فوراً
   - لا تنتظر حتى تحتاج لإجراء معاملة

2. **راجع الحسابات دورياً**
   - تأكد من أن جميع الحسابات مفعّلة وصحيحة
   - عطّل الحسابات غير المستخدمة

3. **خطط للفترات المحاسبية**
   - أنشئ فترات السنة كاملة في بداية السنة المالية
   - أغلق الفترات بانتظام بعد المراجعة

4. **راجع سجل التدقيق**
   - راجع المحاولات المرفوضة أسبوعياً
   - حدد الأنماط المتكررة وعالجها


### للمديرين الماليين

1. **راقب الإشعارات**
   - تابع إشعارات المحاولات المتكررة
   - تدخل سريعاً عند وجود مشاكل

2. **راجع التقارير**
   - استخدم لوحة التحكم لمراجعة إحصائيات التحقق
   - حدد الكيانات التي تحتاج مراجعة

3. **وثّق القرارات**
   - احتفظ بسجل لإعادة فتح الفترات المغلقة
   - وثّق أسباب التجاوزات الاستثنائية

### للمستخدمين العاديين

1. **تحقق قبل الحفظ**
   - تأكد من صحة التاريخ
   - تأكد من اختيار الكيان الصحيح

2. **اقرأ رسائل الخطأ**
   - رسائل الخطأ واضحة وتحتوي على الحل
   - لا تتجاهل التحذيرات

3. **اطلب المساعدة**
   - إذا لم تفهم رسالة خطأ، اسأل المحاسب
   - لا تحاول تجاوز النظام

### للمطورين

1. **استخدم الـ Decorator**
   - طبّق `@require_financial_validation` على جميع المعاملات المالية
   - لا تتجاوز التحقق إلا للحالات الخاصة المعتمدة

2. **اختبر التحقق**
   - اختبر السيناريوهات الصحيحة والخاطئة
   - تأكد من وضوح رسائل الخطأ

3. **وثّق الكود**
   - أضف تعليقات واضحة للحالات الخاصة
   - وثّق أي تجاوزات للتحقق

---


## الجزء السابع: الوصول إلى الأدوات والتقارير

### لوحة تحكم التحقق

للوصول إلى لوحة تحكم التحقق:

1. انتقل إلى **المالية** > **لوحة تحكم التحقق**
2. ستجد:
   - **إحصائيات المحاولات المرفوضة**: عدد المحاولات حسب النوع
   - **أكثر الأخطاء شيوعاً**: الأخطاء الأكثر تكراراً
   - **الكيانات المعلمة للمراجعة**: الكيانات التي تحتاج انتباه
   - **المستخدمين ذوي المحاولات المتكررة**: المستخدمين الذين يواجهون مشاكل

### سجل التدقيق

للوصول إلى سجل التدقيق:

1. انتقل إلى **المالية** > **سجل تدقيق التحقق**
2. يمكنك:
   - البحث حسب المستخدم
   - التصفية حسب نوع الكيان
   - التصفية حسب نوع الخطأ
   - التصفية حسب التاريخ
   - تصدير البيانات للتحليل

### التقارير المتاحة

1. **تقرير المحاولات المرفوضة**
   - عدد المحاولات حسب الوحدة
   - عدد المحاولات حسب نوع الخطأ
   - الاتجاهات الزمنية

2. **تقرير الكيانات بدون حسابات**
   - قائمة بجميع الكيانات التي تحتاج حسابات محاسبية
   - مصنفة حسب النوع

3. **تقرير الفترات المحاسبية**
   - الفترات المفتوحة والمغلقة
   - الفترات القادمة التي تحتاج إنشاء

---


## الجزء الثامن: الحالات الخاصة

### القيود الافتتاحية

القيود الافتتاحية (Opening Entries) هي قيود خاصة تُستخدم لتسجيل الأرصدة الافتتاحية في بداية السنة المالية.

#### الخصائص
- **لا تتطلب فترة محاسبية مفتوحة**
- يتم تسجيلها بشكل خاص في سجل التدقيق
- تتطلب صلاحيات خاصة

#### كيفية إنشاء قيد افتتاحي
1. انتقل إلى **المالية** > **القيود اليومية**
2. اختر **قيد افتتاحي** كنوع القيد
3. أدخل البيانات المطلوبة
4. احفظ القيد

### التسويات المحاسبية

التسويات (Adjustments) هي قيود تصحيحية قد تحتاج إجراءها في فترات مغلقة.

#### الخصائص
- تتطلب صلاحيات خاصة
- يتم تسجيلها مع تحذير في سجل التدقيق
- يجب توثيق سبب التسوية

#### كيفية إنشاء تسوية
1. تأكد من أن لديك صلاحية `financial.bypass_period_check`
2. انتقل إلى **المالية** > **القيود اليومية**
3. اختر **تسوية** كنوع القيد
4. أدخل سبب التسوية
5. احفظ القيد

⚠️ **تحذير**: استخدم التسويات فقط عند الضرورة القصوى وبعد موافقة المدير المالي.

### المعاملات المولدة من النظام

بعض المعاملات يتم إنشاؤها تلقائياً من النظام (مثل القيود التلقائية عند إغلاق الفترة).

#### الخصائص
- يتم التحقق منها بنفس الطريقة
- يتم تسجيلها بشكل مختلف في سجل التدقيق
- لا تتطلب تدخل المستخدم

---


## الجزء التاسع: استكشاف الأخطاء المتقدمة

### المشكلة: رسالة خطأ تظهر رغم وجود حساب محاسبي

#### الأسباب المحتملة
1. الحساب غير مفعّل
2. الحساب ليس نهائياً
3. الحساب مرتبط بكيان آخر

#### الحل
1. تحقق من حالة الحساب في دليل الحسابات
2. تأكد من أن `is_active = True`
3. تأكد من أن `is_leaf = True`
4. تأكد من ربط الحساب الصحيح بالكيان

### المشكلة: لا يمكن إنشاء فترة محاسبية جديدة

#### الأسباب المحتملة
1. تداخل التواريخ مع فترة موجودة
2. تاريخ البداية بعد تاريخ النهاية
3. نقص الصلاحيات

#### الحل
1. تحقق من الفترات الموجودة
2. تأكد من عدم التداخل
3. تأكد من صحة التواريخ
4. تحقق من صلاحياتك

### المشكلة: لا يمكن إغلاق فترة محاسبية

#### الأسباب المحتملة
1. وجود معاملات غير مكتملة
2. نقص الصلاحيات
3. وجود أخطاء في القيود

#### الحل
1. راجع جميع المعاملات في الفترة
2. تأكد من اكتمال جميع القيود
3. صحح أي أخطاء
4. تحقق من صلاحياتك

### المشكلة: بطء في معالجة المعاملات

#### الأسباب المحتملة
1. عدد كبير من السجلات في قاعدة البيانات
2. عدم تحديث الفهارس
3. مشاكل في الشبكة

#### الحل
1. اتصل بمسؤول النظام
2. قد يحتاج النظام لصيانة دورية
3. تحقق من اتصال الإنترنت

---


## الجزء العاشر: جدول مرجعي سريع

### أنواع الكيانات وحساباتها

| نوع الكيان | حقل الحساب | نوع الحساب المحاسبي | مثال |
|-----------|------------|---------------------|------|
| طالب (Student) | `account` | أصول - ذمم مدينة | 1201001 |
| مورد (Supplier) | `account` | خصوم - ذمم دائنة | 2101001 |
| موظف (Employee) | `account` | خصوم - رواتب مستحقة | 2201001 |
| نشاط (Activity) | `revenue_account` | إيرادات | 4101001 |
| خط نقل (Route) | `revenue_account` | إيرادات | 4201001 |

### حالات الحساب المحاسبي

| الحالة | الوصف | يمكن استخدامه؟ |
|-------|-------|----------------|
| مفعّل + نهائي | حساب صحيح | ✅ نعم |
| مفعّل + رئيسي | حساب للتصنيف فقط | ❌ لا |
| غير مفعّل + نهائي | حساب معطّل | ❌ لا |
| غير مفعّل + رئيسي | حساب معطّل | ❌ لا |

### حالات الفترة المحاسبية

| الحالة | الوصف | يمكن إدخال معاملات؟ |
|-------|-------|---------------------|
| مفتوحة (Open) | فترة نشطة | ✅ نعم |
| مغلقة (Closed) | فترة منتهية | ❌ لا |

### رموز الأخطاء الشائعة

| رمز الخطأ | الوصف | الحل السريع |
|----------|-------|-------------|
| `missing_account` | لا يوجد حساب محاسبي | أنشئ حساباً واربطه |
| `inactive_account` | حساب غير مفعّل | فعّل الحساب |
| `not_leaf_account` | حساب رئيسي | استخدم حساباً نهائياً |
| `missing_period` | لا توجد فترة محاسبية | أنشئ فترة للتاريخ |
| `closed_period` | فترة مغلقة | استخدم فترة مفتوحة |

---


## الجزء الحادي عشر: قائمة التحقق للإعداد الأولي

### للمحاسب الجديد

عند البدء في استخدام النظام لأول مرة، اتبع هذه الخطوات:

#### ✅ المرحلة 1: إعداد دليل الحسابات

- [ ] مراجعة دليل الحسابات الموجود
- [ ] إنشاء حسابات جديدة حسب الحاجة
- [ ] التأكد من أن جميع الحسابات المطلوبة نهائية ومفعّلة
- [ ] تصنيف الحسابات بشكل صحيح

#### ✅ المرحلة 2: ربط الكيانات بالحسابات

- [ ] ربط جميع الطلاب بحسابات محاسبية
- [ ] ربط جميع الموردين بحسابات محاسبية
- [ ] ربط جميع الموظفين بحسابات محاسبية
- [ ] ربط جميع الأنشطة بحسابات إيرادات
- [ ] ربط جميع خطوط النقل بحسابات إيرادات

#### ✅ المرحلة 3: إنشاء الفترات المحاسبية

- [ ] إنشاء فترات السنة المالية الحالية
- [ ] التأكد من عدم تداخل الفترات
- [ ] فتح الفترة الحالية فقط
- [ ] إغلاق الفترات السابقة

#### ✅ المرحلة 4: الاختبار

- [ ] اختبار إنشاء دفعة طالب
- [ ] اختبار دفع مستحقات مورد
- [ ] اختبار صرف راتب موظف
- [ ] اختبار تسجيل رسوم نشاط
- [ ] التأكد من عدم ظهور أخطاء

#### ✅ المرحلة 5: التدريب

- [ ] تدريب المستخدمين على النظام
- [ ] شرح رسائل الخطأ الشائعة
- [ ] توزيع هذا الدليل على الفريق
- [ ] إنشاء قناة للدعم الفني

---


## الجزء الثاني عشر: معلومات الاتصال والدعم

### الحصول على المساعدة

إذا واجهت أي مشكلة أو كان لديك أي استفسار:

#### 1. راجع هذا الدليل
- معظم المشاكل الشائعة مشروحة في هذا الدليل
- استخدم جدول المحتويات للوصول السريع

#### 2. تحقق من سجل التدقيق
- قد يحتوي على تفاصيل إضافية عن المشكلة
- يمكن أن يساعد في تحديد السبب الجذري

#### 3. اتصل بالمحاسب الرئيسي
- للمشاكل المتعلقة بالحسابات المحاسبية
- للمشاكل المتعلقة بالفترات المحاسبية

#### 4. اتصل بمسؤول النظام
- للمشاكل التقنية
- لطلب صلاحيات إضافية
- للإبلاغ عن أخطاء في النظام

### الإبلاغ عن مشكلة

عند الإبلاغ عن مشكلة، يرجى تضمين:

1. **وصف المشكلة**: ماذا حدث؟
2. **الخطوات للتكرار**: كيف يمكن إعادة إنتاج المشكلة؟
3. **رسالة الخطأ**: نص رسالة الخطأ الكامل
4. **لقطة شاشة**: إن أمكن
5. **التاريخ والوقت**: متى حدثت المشكلة؟
6. **المستخدم**: من واجه المشكلة؟

### اقتراحات التحسين

نرحب باقتراحاتكم لتحسين النظام! يمكنكم:

- إرسال اقتراحاتكم لمسؤول النظام
- المشاركة في اجتماعات المراجعة الدورية
- تقديم ملاحظات على هذا الدليل

---


## الملحق أ: مسرد المصطلحات

| المصطلح | الترجمة الإنجليزية | الشرح |
|---------|-------------------|--------|
| الحساب المحاسبي | Chart of Accounts | رمز فريد في دليل الحسابات لتصنيف المعاملات |
| الفترة المحاسبية | Accounting Period | فترة زمنية محددة لتسجيل المعاملات المالية |
| حساب نهائي | Leaf Account | حساب يمكن تسجيل معاملات عليه مباشرة |
| حساب رئيسي | Parent Account | حساب للتصنيف فقط، لا يمكن تسجيل معاملات عليه |
| قيد افتتاحي | Opening Entry | قيد لتسجيل الأرصدة الافتتاحية |
| تسوية | Adjustment | قيد تصحيحي |
| سجل التدقيق | Audit Log | سجل لجميع المحاولات المرفوضة |
| معاملة مالية | Financial Transaction | أي عملية مالية تؤثر على الحسابات |
| كيان مالي | Financial Entity | طالب، مورد، موظف، نشاط، أو خط نقل |
| ذمم مدينة | Accounts Receivable | مبالغ مستحقة للمؤسسة |
| ذمم دائنة | Accounts Payable | مبالغ مستحقة على المؤسسة |

## الملحق ب: الصلاحيات المطلوبة

| العملية | الصلاحية المطلوبة | الوصف |
|---------|-------------------|--------|
| إنشاء حساب محاسبي | `financial.add_chartofaccounts` | إضافة حساب جديد |
| تعديل حساب محاسبي | `financial.change_chartofaccounts` | تعديل حساب موجود |
| حذف حساب محاسبي | `financial.delete_chartofaccounts` | حذف حساب |
| إنشاء فترة محاسبية | `financial.add_accountingperiod` | إضافة فترة جديدة |
| إغلاق فترة محاسبية | `financial.change_accountingperiod` | تغيير حالة الفترة |
| إعادة فتح فترة مغلقة | `financial.reopen_period` | إعادة فتح فترة |
| تجاوز التحقق | `financial.bypass_period_check` | السماح بالتسويات |
| عرض سجل التدقيق | `financial.view_validationauditlog` | الوصول للسجل |

## الملحق ج: روابط مفيدة

### وثائق ذات صلة

- [دليل المطور - نظام التحقق من المعاملات المالية](financial-validation-developer-guide.md)
- [دليل النظام المالي](financial-system.md)
- [دليل دليل الحسابات](chart-of-accounts-guide.md)
- [دليل الفترات المحاسبية](accounting-periods-guide.md)

### موارد خارجية

- المعايير المحاسبية المصرية
- دليل المحاسبة للمؤسسات التعليمية
- أفضل الممارسات في إدارة الحسابات

---

## الخاتمة

نظام التحقق من المعاملات المالية مصمم لحماية سلامة بياناتك المالية وضمان الامتثال المحاسبي. باتباع الإرشادات في هذا الدليل، ستتمكن من:

- ✅ إعداد الحسابات المحاسبية بشكل صحيح
- ✅ إدارة الفترات المحاسبية بكفاءة
- ✅ فهم رسائل الخطأ وحلها بسرعة
- ✅ الحفاظ على سلامة البيانات المالية

نتمنى لك تجربة استخدام سلسة وفعالة!

---

**تاريخ آخر تحديث**: يناير 2024  
**الإصدار**: 1.0  
**المؤلف**: فريق تطوير نظام إدارة الشركة
